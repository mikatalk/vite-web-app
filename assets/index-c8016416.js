var R=Object.defineProperty;var T=(n,e,t)=>e in n?R(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var g=(n,e,t)=>(T(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();const x="modulepreload",O=function(n){return"/"+n},P={},A=function(e,t,a){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(o=>{if(o=O(o),o in P)return;P[o]=!0;const i=o.endsWith(".css"),p=i?'[rel="stylesheet"]':"";if(!!a)for(let f=s.length-1;f>=0;f--){const h=s[f];if(h.href===o&&(!i||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${p}`))return;const d=document.createElement("link");if(d.rel=i?"stylesheet":x,i||(d.as="script",d.crossOrigin=""),d.href=o,document.head.appendChild(d),i)return new Promise((f,h)=>{d.addEventListener("load",f),d.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>e())};function B(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:a,onRegistered:s,onRegisteredSW:o,onRegisterError:i}=n;let p,m;const d=async(h=!0)=>{await m};async function f(){if("serviceWorker"in navigator){const{Workbox:h}=await A(()=>import("./workbox-window.prod.es5-a7b12eab.js"),[]);p=new h("/sw.js",{scope:"/",type:"classic"}),p.addEventListener("activated",u=>{(u.isUpdate||u.isExternal)&&window.location.reload()}),p.addEventListener("installed",u=>{u.isUpdate||a==null||a()}),p.register({immediate:e}).then(u=>{o?o("/sw.js",u):s==null||s(u)}).catch(u=>{i==null||i(u)})}}return m=f(),d}console.log("Initializing PWA...");"serviceWorker"in navigator&&!/localhost/.test(window.location)&&B();let w;const E=document.querySelector("#main-install-app-button");window.addEventListener("beforeinstallprompt",n=>{n.preventDefault(),w=n,E.style.display="block",E.addEventListener("click",()=>{E.style.display="none",w.prompt(),w.userChoice.then(e=>{e.outcome==="accepted"?console.log("User accepted the A2HS prompt"):console.log("User dismissed the A2HS prompt"),w=null})})});(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0)&&(E.style.display="none");const M=()=>{var n;return!!((n=window.matchMedia)!=null&&n.call(window,"(display-mode: standalone)").matches||window.navigator.standalone)};M()&&(E.style.display="none");window.addEventListener("appinstalled",n=>{console.log("success app install!")});const S=class{constructor(e,t,a=S.UNSET){this.x=e,this.y=t,this.value=a}};let y=S;g(y,"UNSET","unset"),g(y,"SET","set");class N{constructor(){g(this,"cells",Array.from({length:100}).map((e,t)=>new y(t%10,Math.floor(t/10))))}getCellValueAtIndex(e){return this.cells[e].value}setCellValueAtIndex(e,t){this.cells[e].value=t}getCellValueAtPoint(e,t){return this.getCellValueAtIndex(this.pointToIndex(e,t))}setCellValueAtPoint(e,t,a){this.setCellValueAtIndex(this.pointToIndex(e,t),a)}pointToIndex(e,t){return e+10*t}}const c=class{constructor(e=null,t,a){g(this,"thumbnail",null);e&&(this.points=c.PIECES.find(s=>s.type===e)),this.points=this.getRandomPiece(),this.thumbnail=c.makeThumbnail(this)}getRandomPiece(){return JSON.parse(JSON.stringify(c.PIECES[Math.floor(c.PIECES.length*Math.random())]))}static makeThumbnail(e){const t=new Image;t.width=c.canvas.width=100,t.height=c.canvas.height=100;const a=c.context;return a.fillStyle="transparent",a.fillRect(0,0,100,100),a.fillStyle="red",a.fillRect(0,0,10,10),a.fillStyle="green",a.fillRect(90,90,10,10),t.src=c.canvas.toDataURL("image/png").replace("image/png","image/octet-stream"),t}};let v=c;g(v,"PIECES",[{type:"BigL",rotationAble:!0,points:[[0,0],[1,0],[2,0],[2,1],[2,2]]},{type:"SmallL",rotationAble:!0,points:[[0,0],[1,0],[1,1]]},{type:"Dot",rotationAble:!1,points:[[0,0]]},{type:"SmallSquare",rotationAble:!1,points:[[0,0],[1,0],[0,1],[1,1]]},{type:"BigSquare",rotationAble:!1,points:[[0,0],[1,0],[2,0],[0,1],[1,1],[2,1],[0,2],[1,2],[2,2]]},{type:"Line2",rotationAble:!0,points:[[0,0],[1,0]]},{type:"Line3",rotationAble:!0,points:[[0,0],[1,0],[2,0]]},{type:"Line4",rotationAble:!0,points:[[0,0],[1,0],[2,0],[3,0]]},{type:"Line5",rotationAble:!0,points:[[0,0],[1,0],[2,0],[3,0],[4,0]]}]),g(v,"canvas",document.createElement("canvas")),g(v,"context",c.canvas.getContext("2d"));const l={bankPieces:[],grid:new N,changes:{grid:{previous:0,value:1},bank:{previous:0,value:1}}},r={state:l,mutate:{doSomething(){l.grid.setCellValueAtPoint(Math.floor(Math.random()*10),Math.floor(Math.random()*10),y[Math.random()>.5?"SET":"UNSET"]),l.changes.grid.value+=1},addPieceToBank(){l.bankPieces.push(new v),l.changes.bank.value+=1},hasRendered(n){l.changes[n].previous=l.changes[n].value}},getters:{gridChanged:()=>l.changes.grid.previous!==l.changes.grid.value,bankChanged:()=>l.changes.bank.previous!==l.changes.bank.value}},L=class{static loadImages(e,t,a){let s=0;const o=()=>{s+=1/e.length,t(s),s==1&&a()};for(let{name:i,url:p}of e){const m=new Image;m.src=p,m.onload=o,L.files[i]=m}}static getImage(e){return files[e]}};let b=L;g(b,"files",{});console.log("store:",r);console.log("cells:",r.state.grid.cells);const U=document.querySelector("#app .grid"),C=[];r.state.grid.cells.forEach(({value:n})=>{const e=document.createElement("div");e.classList.add("box"),n==="set"&&e.classList.add("active"),C.push(e),U.appendChild(e)});const k=document.querySelector("#app .footer .bank");b.loadImages([{name:"",url:A(()=>import("./tile-2c47db68.js"),[])}],n=>console.log("Progress:",n),()=>{r.mutate.addPieceToBank(),r.mutate.addPieceToBank(),r.mutate.addPieceToBank(),I()});function I(){window.requestAnimationFrame(I),r.getters.gridChanged()&&V(),r.getters.bankChanged()&&W()}function V(){console.log("redraw grid"),r.state.grid.cells.forEach(({value:n},e)=>{const t=C[e];n==="set"?t.classList.add("active"):t.classList.remove("active")}),r.mutate.hasRendered("grid")}function W(){console.log("redraw bank"),k.innerHTML="",r.state.bankPieces.forEach((n,e)=>{const t=document.createElement("div");t.appendChild(n.thumbnail),t.classList.add("piece"),k.appendChild(t)}),r.mutate.hasRendered("bank")}
