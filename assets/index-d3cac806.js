var D=Object.defineProperty;var F=(a,e,i)=>e in a?D(a,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[e]=i;var h=(a,e,i)=>(F(a,typeof e!="symbol"?e+"":e,i),i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const t of o)if(t.type==="childList")for(const r of t.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function i(o){const t={};return o.integrity&&(t.integrity=o.integrity),o.referrerPolicy&&(t.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?t.credentials="include":o.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function s(o){if(o.ep)return;o.ep=!0;const t=i(o);fetch(o.href,t)}})();const J="modulepreload",W=function(a){return"/"+a},R={},q=function(e,i,s){if(!i||i.length===0)return e();const o=document.getElementsByTagName("link");return Promise.all(i.map(t=>{if(t=W(t),t in R)return;R[t]=!0;const r=t.endsWith(".css"),n=r?'[rel="stylesheet"]':"";if(!!s)for(let f=o.length-1;f>=0;f--){const m=o[f];if(m.href===t&&(!r||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${t}"]${n}`))return;const u=document.createElement("link");if(u.rel=r?"stylesheet":J,r||(u.as="script",u.crossOrigin=""),u.href=t,document.head.appendChild(u),r)return new Promise((f,m)=>{u.addEventListener("load",f),u.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${t}`)))})})).then(()=>e())};function j(a={}){const{immediate:e=!1,onNeedRefresh:i,onOfflineReady:s,onRegistered:o,onRegisteredSW:t,onRegisterError:r}=a;let n,l;const u=async(m=!0)=>{await l};async function f(){if("serviceWorker"in navigator){const{Workbox:m}=await q(()=>import("./workbox-window.prod.es5-a7b12eab.js"),[]);n=new m("/sw.js",{scope:"/",type:"classic"}),n.addEventListener("activated",d=>{(d.isUpdate||d.isExternal)&&window.location.reload()}),n.addEventListener("installed",d=>{d.isUpdate||s==null||s()}),n.register({immediate:e}).then(d=>{t?t("/sw.js",d):o==null||o(d)}).catch(d=>{r==null||r(d)})}}return l=f(),u}"serviceWorker"in navigator&&!/localhost/.test(window.location)&&j();let I;const k=document.querySelector("#install-btn");window.addEventListener("beforeinstallprompt",a=>{a.preventDefault(),I=a,k.style.display="block",k.addEventListener("click",()=>{k.style.display="none",I.prompt(),I.userChoice.then(e=>{e.outcome==="accepted"?console.log("User accepted the A2HS prompt"):console.log("User dismissed the A2HS prompt"),I=null})})});(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0)&&(k.style.display="none");const G=()=>{var a;return!!((a=window.matchMedia)!=null&&a.call(window,"(display-mode: standalone)").matches||window.navigator.standalone)};G()&&(k.style.display="none");window.addEventListener("appinstalled",a=>{console.log("success app install!")});const x=class{constructor(e,i,s=x.UNSET){this.x=e,this.y=i,this.value=s}};let g=x;h(g,"UNSET","unset"),h(g,"SET","set"),h(g,"PREVIEW","preview");class K{constructor(){h(this,"cells",Array.from({length:100}).map((e,i)=>new g(i%10,Math.floor(i/10))))}getCellValueAtIndex(e){return this.cells[e].value}setCellValueAtIndex(e,i){if(e<0||e>this.cells.length)return console.log("ERROR - index out of range:",e),null;this.cells[e].value=i}getCellValueAtPoint(e,i){return e<0||e>9||i<0||i>9?(console.log("ERROR - index out of range:",index),null):this.getCellValueAtIndex(this.pointToIndex(e,i))}setCellValueAtPoint(e,i,s){this.setCellValueAtIndex(this.pointToIndex(e,i),s)}pointToIndex(e,i){return e+10*i}reset(){this.cells.forEach(e=>{e.value=g.UNSET})}doesItFitAt(e,i,s,o=g.SET){this.cells.forEach(d=>{d.value===g.PREVIEW&&(d.value=g.UNSET)});const t=1+Math.max(...s.map(([d])=>d))-Math.min(...s.map(([d])=>d)),r=1+Math.max(...s.map(([,d])=>d))-Math.min(...s.map(([,d])=>d)),n=Math[t%2===0?"round":"floor"](e*10),l=Math[r%2===0?"round":"floor"](i*10);if(n<-1||n>9||l<-1||l>9)return!1;const u=n-Math[t%2===0?"round":"floor"](t/2),f=l-Math[r%2===0?"round":"floor"](r/2);let m=!0;return s.forEach(([d,N])=>{const E=u+d,b=f+N;E>-1&&E<10&&b>-1&&b<10?this.getCellValueAtPoint(E,b)===g.SET&&(m=!1):m=!1}),s.forEach(([d,N])=>{const E=u+d,b=f+N;if(E>-1&&E<10&&b>-1&&b<10){const M=this.getCellValueAtPoint(E,b);this.setCellValueAtPoint(E,b,M===g.SET?g.SET:m?o:g.UNSET)}}),m}}const C=class{static loadImages(e,i,s){let o=0;for(let{name:t,url:r}of e){const n=new Image;n.onload=()=>{o+=1/e.length,i(o),o==1&&s()},n.src=r,C.files[t]=n}}static getImage(e){return C.files[e]}};let w=C;h(w,"files",{});const p=class{constructor(e=p.getRandomType()){h(this,"imageString","");this.type=e,this.polyline=JSON.parse(JSON.stringify(e===p.PIECE_NONE.type?p.PIECE_NONE:p.PIECES.find(i=>i.type===e))),this.makeThumbnail()}static getRandomType(){return p.PIECES[Math.floor(p.PIECES.length*Math.random())].type}rotatePiece(){const e=1+Math.max(...this.polyline.points.map(([n])=>n))-Math.min(...this.polyline.points.map(([n])=>n)),i=1+Math.max(...this.polyline.points.map(([,n])=>n))-Math.min(...this.polyline.points.map(([,n])=>n)),s=Math.max(e,i),{points:o}=this.polyline;let t=[];for(let n=0;n<s;n+=1){t.push([]);for(let l=0;l<s;l+=1){const u=o.find(([f,m])=>l===f&&n===m);t[n].push(u?1:0)}}console.log("Piece points 1:",o),console.log(`Piece rotation 1:
`+t.join(`
`)),t=t.map((n,l)=>t.map(u=>u[l]).reverse()),console.log(`Piece rotation 2:
`+t.join(`
`));const r=e-i;if(e>i)for(let n=0;n<s;n+=1)for(let l=0;l<s;l+=1)l+r<s?t[n][l]=t[n][l+r]:t[n][l]=0;console.log(`Piece rotation 3:
`+t.join(`
`)),this.polyline.points=[];for(let n=0;n<t.length;n+=1)for(let l=0;l<t[n].length;l+=1)t[l][n]===1&&this.polyline.points.push([n,l]);console.log("Piece points 2:",o),this.makeThumbnail()}copyPiece(e){this.type=e.type,this.polyline=JSON.parse(JSON.stringify(this.type===p.PIECE_NONE.type?p.PIECE_NONE:p.PIECES.find(({type:i})=>i===this.type))),this.makeThumbnail()}shuffle(){this.type=p.getRandomType(),this.polyline=JSON.parse(JSON.stringify(this.type===p.PIECE_NONE.type?p.PIECE_NONE:p.PIECES.find(({type:e})=>e===this.type))),this.makeThumbnail()}disable(){this.polyline=p.PIECE_NONE,this.type=p.PIECE_NONE.type,this.makeThumbnail()}makeThumbnail(){p.canvas.width=100,p.canvas.height=100;const e=p.context;e.clearRect(0,0,100,100);const i=w.getImage("tile"),s=1+Math.max(...this.polyline.points.map(([t])=>t))-Math.min(...this.polyline.points.map(([t])=>t)),o=1+Math.max(...this.polyline.points.map(([,t])=>t))-Math.min(...this.polyline.points.map(([,t])=>t));if(i)for(let[t,r]of this.polyline.points)e.drawImage(i,50-s*10+t*20,50-o*10+r*20,18,18);this.imageString=p.canvas.toDataURL("image/png").replace("image/png","image/octet-stream")}};let y=p;h(y,"PIECE_NONE",{type:"none",points:[]}),h(y,"PIECES",[{type:"MidX4",rotationAble:!0,points:[[0,0],[1,1],[2,2],[3,3]]},{type:"MidX2",rotationAble:!0,points:[[0,0],[1,1],[2,2]]},{type:"MidX",rotationAble:!0,points:[[0,0],[1,1]]},{type:"MidPlus",rotationAble:!0,points:[[1,0],[0,1],[1,1],[2,1],[1,2]]},{type:"MidTT",rotationAble:!0,points:[[0,0],[1,0],[2,0],[1,1],[1,2]]},{type:"MidT",rotationAble:!0,points:[[0,0],[1,0],[2,0],[1,1]]},{type:"MidL",rotationAble:!0,points:[[0,0],[1,0],[0,1],[0,2]]},{type:"MidL2",rotationAble:!0,points:[[0,0],[1,0],[2,0],[2,1]]},{type:"BigL",rotationAble:!0,points:[[0,0],[1,0],[2,0],[2,1],[2,2]]},{type:"SmallL",rotationAble:!0,points:[[0,0],[1,0],[1,1]]},{type:"Dot",rotationAble:!1,points:[[0,0]]},{type:"SmallSquare",rotationAble:!1,points:[[0,0],[1,0],[0,1],[1,1]]},{type:"BigSquare",rotationAble:!1,points:[[0,0],[1,0],[2,0],[0,1],[1,1],[2,1],[0,2],[1,2],[2,2]]},{type:"Line2",rotationAble:!0,points:[[0,0],[1,0]]},{type:"Line3",rotationAble:!0,points:[[0,0],[1,0],[2,0]]},{type:"Line4",rotationAble:!0,points:[[0,0],[1,0],[2,0],[3,0]]},{type:"Line5",rotationAble:!0,points:[[0,0],[1,0],[2,0],[3,0],[4,0]]}]),h(y,"canvas",document.createElement("canvas")),h(y,"context",p.canvas.getContext("2d"));const c={score:0,bankPieces:[new y(y.PIECE_NONE.type),new y(y.PIECE_NONE.type),new y(y.PIECE_NONE.type)],backupPiece:new y(y.PIECE_NONE.type),grid:new K,changes:{grid:{previous:0,value:1},bank:{previous:0,value:1}}},A={state:c,mutate:{resetBank(){c.bankPieces.forEach(a=>a.shuffle()),c.changes.bank.value+=1},undo(){},restart(){c.grid.reset(),c.bankPieces.forEach(a=>a.shuffle()),c.score=0,c.backupPiece.disable(),c.changes.grid.value+=1,c.changes.bank.value+=1},hasRendered(a){c.changes[a].previous=c.changes[a].value},bumpScoreBy(a){c.score+=a},setBackupPiece(a){c.changes.bank.value+=1,c.backupPiece.copyPiece(a)},removeFromBank(a){c.changes.bank.value+=1,a.disable(),c.bankPieces.filter(({type:e})=>e===y.PIECE_NONE.type).length===3&&(A.mutate.resetBank(),c.changes.bank.value+=1)},checkWins(){const a=[],e=[];for(let i=0;i<10;i+=1){let s=0,o=0;for(let t=0;t<10;t+=1)c.grid.getCellValueAtPoint(t,i)===g.SET&&(s+=1),c.grid.getCellValueAtPoint(i,t)===g.SET&&(o+=1);a.push(s),e.push(o)}for(let i=0;i<10;i+=1){if(a[i]==10)for(let s=0;s<10;s+=1)c.grid.setCellValueAtPoint(s,i,g.UNSET);if(e[i]==10)for(let s=0;s<10;s+=1)c.grid.setCellValueAtPoint(i,s,g.UNSET)}}},getters:{getPieceById:a=>{switch(a){case"bank-piece-1":return c.bankPieces[0];case"bank-piece-2":return c.bankPieces[1];case"bank-piece-3":return c.bankPieces[2];case"backup-piece":return c.backupPiece}},canAcceptBackup:()=>c.backupPiece.type===y.PIECE_NONE.type,gridChanged:()=>c.changes.grid.previous!==c.changes.grid.value,bankChanged:()=>c.changes.bank.previous!==c.changes.bank.value}};class Q{constructor(e,i,s){h(this,"image",new Image);h(this,"pieceId","");h(this,"lastX",-1);h(this,"lastY",-1);h(this,"startX",-1);h(this,"startY",-1);h(this,"touchStart",e=>{e.stopPropagation(),e.preventDefault();const[i]=e.touches;"pageX"in e||(e.pageX=i.pageX,e.pageY=i.pageY),this.dragStart(e)});h(this,"dragStart",e=>{if(this.dragging)return;this.pieceId=e.target.id,this.callBack("drag",{pieceId:this.pieceId}),this.image.src=e.target.src,this.showImage();const{width:i}=this.dragTo.getBoundingClientRect(),s=i/2.4;this.image.style.width=this.image.style.height=s+"px",this.image.style.top=e.pageY-window.scrollY-s/2+"px",this.image.style.left=e.pageX-s/2+"px",this.image.focus();const{x:o,y:t}=this.getDropPosition(e);this.startX=o,this.startY=t});h(this,"touchMove",e=>{const[i]=e.touches;"pageX"in e||(e.pageX=i.pageX,e.pageY=i.pageY),this.dragMove(e)});h(this,"dragMove",e=>{if(!this.dragging)return;const{width:i}=this.dragTo.getBoundingClientRect(),s=i/2.2;this.image.style.width=this.image.style.height=s+"px",this.image.style.top=e.pageY-window.scrollY-s/2+"px",this.image.style.left=e.pageX-s/2+"px";const{x:o,y:t}=this.getDropPosition(e);this.lastX=o,this.lastY=t,this.callBack("move",{x:o,y:t,pieceId:this.pieceId})});h(this,"dragStop",e=>{this.dragging&&(e.preventDefault(),e.stopPropagation(),this.lastX===-1&&this.lastY===-1||this.lastY>1&&this.lastX>0&&this.lastX<.8?(console.log("ROTATE"),this.callBack("rotate",{x:this.lastX,y:this.lastY,pieceId:this.pieceId}),this.pieceId=null,this.hideImage()):(this.callBack("drop",{x:this.lastX,y:this.lastY,pieceId:this.pieceId}),this.pieceId=null,this.hideImage(),navigator.vibrate(60)),this.lastX=this.lastY=-1)});this.dragFromElements=e,this.dragTo=i,this.callBack=s,this.image.id="draggable-image",this.image.draggable=!1,this.image.style.imageRendering="pixelated",this.image.style.position="fixed",document.body.appendChild(this.image),this.hideImage(),e.forEach((o,t)=>{o.addEventListener("mousedown",this.dragStart),o.addEventListener("touchstart",this.touchStart),document.addEventListener("touchmove",this.touchMove),document.addEventListener("mousemove",this.dragMove),document.addEventListener("touchup",this.dragStop),document.addEventListener("touchend",this.dragStop),document.addEventListener("touchcancel",this.dragStop),document.addEventListener("mouseleave",this.dragStop),document.addEventListener("mouseup",this.dragStop)})}getDropPosition(e){const i=e.pageX,s=e.pageY-window.scrollY,o=10,t=5,{left:r,top:n,width:l,height:u}=this.dragTo.getBoundingClientRect(),f=(i-r-o)/(l-o*2),m=(s-n-t)/(u-t*2);return{x:f,y:m}}showImage(){this.image.style.display="block",document.body.style.overflow="hidden",document.body.style.touchAction="none"}hideImage(){this.image.style.display="none",document.body.style.overflow="auto",document.body.style.touchAction=g.UNSET}get dragging(){return this.pieceId!==null&&this.pieceId!==""}}const H="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAACXBIWXMAAC4jAAAuIwF4pT92AAAAkElEQVQ4je2TsQ2EMBAE5yxniBKQaOGroJKviqJoAR0lIGJ/5MdgbBmLkI0u2J07nbSiqgB86Rw3NbIIgKjqH9C35YB53UEyqIsAnyYdnrYYJIM65wG5cAo2r2BKtl8p9Ju0rVzWD/68kovCvxwgV4YQeA5mIbmNKT3ykxcSy8LegZoCwqnFNRpZxPihFgDwA8xLMfsgKlu+AAAAAElFTkSuQmCC",z="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAnUlEQVQ4je3UsRGAIAwF0ITDHWzcx9YpnMkpaN3Hxh0sYiHh4hlEoqW/EozvcngEiQhi0oMhCADgJdQv9crcpe8RKbbG0NA+h8J6AgGJiDRobPLItOlgwhi6Q3JoWA/MyZc1kFbv9DJbvFxw2086lOemYlqhhDWgiJU6yOXTM/ux+qS/yXfMctE5l6lhCU8NB3Gw8YYVgjjPePF60u7kPTzr9IUubAAAAABJRU5ErkJggg==",Z="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAACXBIWXMAAC4jAAAuIwF4pT92AAAAkElEQVQ4je2TsRHDIBAEF0aZEjVAEerKXXjUhbtyD/8NOFGMorcwGAYxDn3RB3f78DPnRASAEMKdi1LVDcCJyBtwe/UDHssJcjHGArDO9fBzL0E+BaxzG5B7LOd7ttdgJl+39Wuywf7a86L0Lh+Qb4YUmAebkNbGmn5ykz+k1ARnB0YKCFmLR6Sqm7dhFABwAK+SM/VZKn/WAAAAAElFTkSuQmCC",{state:v,getters:B}=A,{grid:T}=v,{cells:L}=T,$=document.querySelector("#restart-btn");$.addEventListener("click",()=>A.mutate.restart());const O=document.querySelector("#app .grid"),Y=[];L.forEach(({value:a})=>{const e=document.createElement("div");e.classList.add("box"),a===g.SET&&e.classList.add("active"),Y.push(e),O.appendChild(e)});const _=document.querySelector("#app .score-header .score-value"),X=document.querySelector("#app .footer .bank"),P=[...X.querySelectorAll(".next.piece img")],S=X.querySelector(".backup.piece img");new Q([...P,S],O,(a,e)=>{const{x:i,y:s,pieceId:o}=e,t=document.getElementById(o),r=B.getPieceById(o);switch(a){case"rotate":console.log("ROTATE",t),r.rotatePiece(),t.src=r.imageString,t.style.opacity=1,v.changes.bank.value+=1,V();break;case"drag":t.style.opacity=0;break;case"move":const{points:n}=r.polyline;T.doesItFitAt(i,s,n,g.PREVIEW),v.changes.grid.value+=1;break;case"drop":{if(i>.75&&s>1&&A.getters.canAcceptBackup()){console.log("BANK DROP!"),A.mutate.setBackupPiece(r),A.mutate.removeFromBank(r);return}const{points:l}=r.polyline;T.doesItFitAt(i,s,l,g.SET)?(A.mutate.bumpScoreBy(l.length),A.mutate.removeFromBank(r),A.mutate.checkWins(),t.style.opacity=0):t.style.opacity=1,v.changes.grid.value+=1}break}});w.loadImages([{name:"tile",url:H},{name:"tile-highlight",url:z},{name:"tile-hover",url:Z}],a=>console.log("Progress:",a),()=>{A.mutate.resetBank(),U()});function U(){window.requestAnimationFrame(U),B.gridChanged()&&(te(),ee()),B.bankChanged()&&V()}function ee(){_.innerHTML=v.score.toLocaleString()}function te(){console.log("redraw grid"),L.forEach(({value:a},e)=>{const i=Y[e];i.className="box "+a}),A.mutate.hasRendered("grid")}function V(){console.log("redraw bank"),A.state.bankPieces.forEach((a,e)=>{P[e].src=a.imageString,P[e].setAttribute("piece-type",a.type),P[e].style.opacity=1}),S.src=A.state.backupPiece.imageString,S.style.opacity=1,S.setAttribute("piece-type",A.state.backupPiece.type),A.mutate.hasRendered("bank")}console.log("v1");
