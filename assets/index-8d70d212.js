var M=Object.defineProperty;var T=(i,e,t)=>e in i?M(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var l=(i,e,t)=>(T(i,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}})();const x="modulepreload",U=function(i){return"/"+i},B={},D=function(e,t,o){if(!t||t.length===0)return e();const n=document.getElementsByTagName("link");return Promise.all(t.map(a=>{if(a=U(a),a in B)return;B[a]=!0;const s=a.endsWith(".css"),d=s?'[rel="stylesheet"]':"";if(!!o)for(let p=n.length-1;p>=0;p--){const A=n[p];if(A.href===a&&(!s||A.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${d}`))return;const h=document.createElement("link");if(h.rel=s?"stylesheet":x,s||(h.as="script",h.crossOrigin=""),h.href=a,document.head.appendChild(h),s)return new Promise((p,A)=>{h.addEventListener("load",p),h.addEventListener("error",()=>A(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>e())};function O(i={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:o,onRegistered:n,onRegisteredSW:a,onRegisterError:s}=i;let d,v;const h=async(A=!0)=>{await v};async function p(){if("serviceWorker"in navigator){const{Workbox:A}=await D(()=>import("./workbox-window.prod.es5-a7b12eab.js"),[]);d=new A("/sw.js",{scope:"/",type:"classic"}),d.addEventListener("activated",u=>{(u.isUpdate||u.isExternal)&&window.location.reload()}),d.addEventListener("installed",u=>{u.isUpdate||o==null||o()}),d.register({immediate:e}).then(u=>{a?a("/sw.js",u):n==null||n(u)}).catch(u=>{s==null||s(u)})}}return v=p(),h}console.log("Initializing PWA...");"serviceWorker"in navigator&&!/localhost/.test(window.location)&&O();let w;const y=document.querySelector("#main-install-app-button");window.addEventListener("beforeinstallprompt",i=>{i.preventDefault(),w=i,y.style.display="block",y.addEventListener("click",()=>{y.style.display="none",w.prompt(),w.userChoice.then(e=>{e.outcome==="accepted"?console.log("User accepted the A2HS prompt"):console.log("User dismissed the A2HS prompt"),w=null})})});(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0)&&(y.style.display="none");const V=()=>{var i;return!!((i=window.matchMedia)!=null&&i.call(window,"(display-mode: standalone)").matches||window.navigator.standalone)};V()&&(y.style.display="none");window.addEventListener("appinstalled",i=>{console.log("success app install!")});const S=class{constructor(e,t,o=S.UNSET){this.x=e,this.y=t,this.value=o}};let f=S;l(f,"UNSET","unset"),l(f,"SET","set");class q{constructor(){l(this,"cells",Array.from({length:100}).map((e,t)=>new f(t%10,Math.floor(t/10))))}getCellValueAtIndex(e){return this.cells[e].value}setCellValueAtIndex(e,t){this.cells[e].value=t}getCellValueAtPoint(e,t){return this.getCellValueAtIndex(this.pointToIndex(e,t))}setCellValueAtPoint(e,t,o){this.setCellValueAtIndex(this.pointToIndex(e,t),o)}pointToIndex(e,t){return e+10*t}}const E=class{static loadImages(e,t,o){console.log("loading...",e);let n=0;for(let{name:a,url:s}of e){const d=new Image;d.onload=()=>{n+=1/e.length,t(n),console.log(" - progress:",n),n==1&&(console.log(" - done:",n),o())},d.src=s,E.files[a]=d}}static getImage(e){return E.files[e]}};let b=E;l(b,"files",{});const g=class{constructor(e=g.getRandomType()){l(this,"thumbnail",null);this.type=e,this.polyline=g.PIECES.find(t=>t.type===e),this.thumbnail=this.makeThumbnail()}static getRandomType(){return g.PIECES[Math.floor(g.PIECES.length*Math.random())].type}makeThumbnail(){const e=new Image;e.width=g.canvas.width=100,e.height=g.canvas.height=100;const t=g.context;t.clearRect(0,0,100,100);const o=b.getImage("tile"),n=1+Math.max(...this.polyline.points.map(([s])=>s))-Math.min(...this.polyline.points.map(([s])=>s)),a=1+Math.max(...this.polyline.points.map(([,s])=>s))-Math.min(...this.polyline.points.map(([,s])=>s));if(o)for(let[s,d]of this.polyline.points)t.drawImage(o,50-n*10+s*20,50-a*10+d*20,18,18);return e.src=g.canvas.toDataURL("image/png").replace("image/png","image/octet-stream"),e}};let m=g;l(m,"PIECES",[{type:"BigL",rotationAble:!0,points:[[0,0],[1,0],[2,0],[2,1],[2,2]]},{type:"SmallL",rotationAble:!0,points:[[0,0],[1,0],[1,1]]},{type:"Dot",rotationAble:!1,points:[[0,0]]},{type:"SmallSquare",rotationAble:!1,points:[[0,0],[1,0],[0,1],[1,1]]},{type:"BigSquare",rotationAble:!1,points:[[0,0],[1,0],[2,0],[0,1],[1,1],[2,1],[0,2],[1,2],[2,2]]},{type:"Line2",rotationAble:!0,points:[[0,0],[1,0]]},{type:"Line3",rotationAble:!0,points:[[0,0],[1,0],[2,0]]},{type:"Line4",rotationAble:!0,points:[[0,0],[1,0],[2,0],[3,0]]},{type:"Line5",rotationAble:!0,points:[[0,0],[1,0],[2,0],[3,0],[4,0]]}]),l(m,"canvas",document.createElement("canvas")),l(m,"context",g.canvas.getContext("2d"));const c={bankPieces:[],backupPiece:null,grid:new q,changes:{grid:{previous:0,value:1},bank:{previous:0,value:1}}},r={state:c,mutate:{doSomething(){c.grid.setCellValueAtPoint(Math.floor(Math.random()*10),Math.floor(Math.random()*10),f[Math.random()>.5?"SET":"UNSET"]),c.changes.grid.value+=1},addPieceToBank(){c.bankPieces.push(new m),c.changes.bank.value+=1},addBackupPiece(){c.backupPiece=new m,c.changes.bank.value+=1},hasRendered(i){c.changes[i].previous=c.changes[i].value}},getters:{gridChanged:()=>c.changes.grid.previous!==c.changes.grid.value,bankChanged:()=>c.changes.bank.previous!==c.changes.bank.value}};class G{constructor(e,t,o){l(this,"image",new Image);l(this,"dragging",!1);l(this,"dragStart",e=>{console.log(" + drag start",e.target),this.callBack("drag",{piece:e.target}),this.dragging=!0,this.image.src=e.target.src,this.dragMove(e),this.showImage()});l(this,"dragMove",e=>{this.dragging&&(this.image.style.left=e.pageX-this.image.width/2+"px",this.image.style.top=e.pageY-window.scrollY-this.image.width/2+"px")});l(this,"dragStop",e=>{this.dragging&&(console.log(" + drag stop",e.target),this.dragging=!1,this.hideImage())});this.dragFromElements=e,this.dragTo=t,this.callBack=o,this.image.id="draggable-image",console.log("Adding draggable"),this.hideImage(),document.body.appendChild(this.image),this.image.style.pointerEvents="none",e.forEach((n,a)=>{console.log(" + draggable piece",n),n.addEventListener("pointerdown",this.dragStart),t.addEventListener("pointerover",this.dragMove),document.body.addEventListener("pointermove",this.dragMove),n.addEventListener("pointerup",this.dragStop),document.body.addEventListener("pointerup",this.dragStop)})}showImage(){this.image.style.display="block"}hideImage(){this.image.style.display="none"}}const N="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAACXBIWXMAAC4jAAAuIwF4pT92AAAAkElEQVQ4je2TsQ2EMBAE5yxniBKQaOGroJKviqJoAR0lIGJ/5MdgbBmLkI0u2J07nbSiqgB86Rw3NbIIgKjqH9C35YB53UEyqIsAnyYdnrYYJIM65wG5cAo2r2BKtl8p9Ju0rVzWD/68kovCvxwgV4YQeA5mIbmNKT3ykxcSy8LegZoCwqnFNRpZxPihFgDwA8xLMfsgKlu+AAAAAElFTkSuQmCC",W="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAnUlEQVQ4je3UsRGAIAwF0ITDHWzcx9YpnMkpaN3Hxh0sYiHh4hlEoqW/EozvcngEiQhi0oMhCADgJdQv9crcpe8RKbbG0NA+h8J6AgGJiDRobPLItOlgwhi6Q3JoWA/MyZc1kFbv9DJbvFxw2086lOemYlqhhDWgiJU6yOXTM/ux+qS/yXfMctE5l6lhCU8NB3Gw8YYVgjjPePF60u7kPTzr9IUubAAAAABJRU5ErkJggg==",Y="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAACXBIWXMAAC4jAAAuIwF4pT92AAAAkElEQVQ4je2TsRHDIBAEF0aZEjVAEerKXXjUhbtyD/8NOFGMorcwGAYxDn3RB3f78DPnRASAEMKdi1LVDcCJyBtwe/UDHssJcjHGArDO9fBzL0E+BaxzG5B7LOd7ttdgJl+39Wuywf7a86L0Lh+Qb4YUmAebkNbGmn5ykz+k1ARnB0YKCFmLR6Sqm7dhFABwAK+SM/VZKn/WAAAAAElFTkSuQmCC";console.log("store:",r);console.log("cells:",r.state.grid.cells);const L=document.querySelector("#app .grid"),C=[];r.state.grid.cells.forEach(({value:i})=>{const e=document.createElement("div");e.classList.add("box"),i==="set"&&e.classList.add("active"),C.push(e),L.appendChild(e)});const P=document.querySelector("#app .footer .bank"),k=[...P.querySelectorAll(".next.piece img")],I=P.querySelector(".backup.piece img");new G([...k,I],L,(i,e)=>{switch(console.log("DRAG?",i,e),i){case"drag":console.log("DRAG",e);break;case"drop":console.log("DROP",e);break}});b.loadImages([{name:"tile",url:N},{name:"tile-highlight",url:W},{name:"tile-hover",url:Y}],i=>console.log("Progress:",i),()=>{r.mutate.addPieceToBank(),r.mutate.addPieceToBank(),r.mutate.addPieceToBank(),r.mutate.addBackupPiece(),R()});function R(){window.requestAnimationFrame(R),r.getters.gridChanged()&&F(),r.getters.bankChanged()&&J()}function F(){console.log("redraw grid"),r.state.grid.cells.forEach(({value:i},e)=>{const t=C[e];i==="set"?t.classList.add("active"):t.classList.remove("active")}),r.mutate.hasRendered("grid")}function J(){console.log("redraw bank"),r.state.bankPieces.forEach((i,e)=>{k[e].src=i.thumbnail.src,k[e].setAttribute("piece-type",i.type)}),I.src=r.state.backupPiece.thumbnail.src,I.setAttribute("piece-type",r.state.backupPiece.type),r.mutate.hasRendered("bank")}
