var C=Object.defineProperty;var R=(s,e,t)=>e in s?C(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var m=(s,e,t)=>(R(s,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();const T="modulepreload",x=function(s){return"/"+s},P={},B=function(e,t,a){if(!t||t.length===0)return e();const n=document.getElementsByTagName("link");return Promise.all(t.map(o=>{if(o=x(o),o in P)return;P[o]=!0;const i=o.endsWith(".css"),d=i?'[rel="stylesheet"]':"";if(!!a)for(let h=n.length-1;h>=0;h--){const p=n[h];if(p.href===o&&(!i||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${d}`))return;const u=document.createElement("link");if(u.rel=i?"stylesheet":T,i||(u.as="script",u.crossOrigin=""),u.href=o,document.head.appendChild(u),i)return new Promise((h,p)=>{u.addEventListener("load",h),u.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>e())};function O(s={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:a,onRegistered:n,onRegisteredSW:o,onRegisterError:i}=s;let d,S;const u=async(p=!0)=>{await S};async function h(){if("serviceWorker"in navigator){const{Workbox:p}=await B(()=>import("./workbox-window.prod.es5-a7b12eab.js"),[]);d=new p("/sw.js",{scope:"/",type:"classic"}),d.addEventListener("activated",g=>{(g.isUpdate||g.isExternal)&&window.location.reload()}),d.addEventListener("installed",g=>{g.isUpdate||a==null||a()}),d.register({immediate:e}).then(g=>{o?o("/sw.js",g):n==null||n(g)}).catch(g=>{i==null||i(g)})}}return S=h(),u}console.log("Initializing PWA...");"serviceWorker"in navigator&&!/localhost/.test(window.location)&&O();let b;const y=document.querySelector("#main-install-app-button");window.addEventListener("beforeinstallprompt",s=>{s.preventDefault(),b=s,y.style.display="block",y.addEventListener("click",()=>{y.style.display="none",b.prompt(),b.userChoice.then(e=>{e.outcome==="accepted"?console.log("User accepted the A2HS prompt"):console.log("User dismissed the A2HS prompt"),b=null})})});(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0)&&(y.style.display="none");const q=()=>{var s;return!!((s=window.matchMedia)!=null&&s.call(window,"(display-mode: standalone)").matches||window.navigator.standalone)};q()&&(y.style.display="none");window.addEventListener("appinstalled",s=>{console.log("success app install!")});const k=class{constructor(e,t,a=k.UNSET){this.x=e,this.y=t,this.value=a}};let v=k;m(v,"UNSET","unset"),m(v,"SET","set");class M{constructor(){m(this,"cells",Array.from({length:100}).map((e,t)=>new v(t%10,Math.floor(t/10))))}getCellValueAtIndex(e){return this.cells[e].value}setCellValueAtIndex(e,t){this.cells[e].value=t}getCellValueAtPoint(e,t){return this.getCellValueAtIndex(this.pointToIndex(e,t))}setCellValueAtPoint(e,t,a){this.setCellValueAtIndex(this.pointToIndex(e,t),a)}pointToIndex(e,t){return e+10*t}}const E=class{static loadImages(e,t,a){console.log("loading...",e);let n=0;for(let{name:o,url:i}of e){const d=new Image;d.onload=()=>{n+=1/e.length,t(n),console.log(" - progress:",n),n==1&&(console.log(" - done:",n),a())},d.src=i,E.files[o]=d}}static getImage(e){return E.files[e]}};let w=E;m(w,"files",{});const c=class{constructor(e=null,t,a){m(this,"thumbnail",null);e&&(this.points=c.PIECES.find(n=>n.type===e)),this.points=this.getRandomPiece(),this.thumbnail=c.makeThumbnail(this)}getRandomPiece(){return JSON.parse(JSON.stringify(c.PIECES[Math.floor(c.PIECES.length*Math.random())]))}static makeThumbnail(e){const t=new Image;t.width=c.canvas.width=100,t.height=c.canvas.height=100;const a=c.context,n=w.getImage("tile-hover");return a.clearRect(0,0,100,100),a.drawImage(n,0,40,20,20),a.drawImage(n,20,40,20,20),a.drawImage(n,40,40,20,20),a.drawImage(n,60,40,20,20),a.drawImage(n,80,40,20,20),t.src=c.canvas.toDataURL("image/png").replace("image/png","image/octet-stream"),t}};let f=c;m(f,"PIECES",[{type:"BigL",rotationAble:!0,points:[[0,0],[1,0],[2,0],[2,1],[2,2]]},{type:"SmallL",rotationAble:!0,points:[[0,0],[1,0],[1,1]]},{type:"Dot",rotationAble:!1,points:[[0,0]]},{type:"SmallSquare",rotationAble:!1,points:[[0,0],[1,0],[0,1],[1,1]]},{type:"BigSquare",rotationAble:!1,points:[[0,0],[1,0],[2,0],[0,1],[1,1],[2,1],[0,2],[1,2],[2,2]]},{type:"Line2",rotationAble:!0,points:[[0,0],[1,0]]},{type:"Line3",rotationAble:!0,points:[[0,0],[1,0],[2,0]]},{type:"Line4",rotationAble:!0,points:[[0,0],[1,0],[2,0],[3,0]]},{type:"Line5",rotationAble:!0,points:[[0,0],[1,0],[2,0],[3,0],[4,0]]}]),m(f,"canvas",document.createElement("canvas")),m(f,"context",c.canvas.getContext("2d"));const l={bankPieces:[],grid:new M,changes:{grid:{previous:0,value:1},bank:{previous:0,value:1}}},r={state:l,mutate:{doSomething(){l.grid.setCellValueAtPoint(Math.floor(Math.random()*10),Math.floor(Math.random()*10),v[Math.random()>.5?"SET":"UNSET"]),l.changes.grid.value+=1},addPieceToBank(){l.bankPieces.push(new f),l.changes.bank.value+=1},hasRendered(s){l.changes[s].previous=l.changes[s].value}},getters:{gridChanged:()=>l.changes.grid.previous!==l.changes.grid.value,bankChanged:()=>l.changes.bank.previous!==l.changes.bank.value}};console.log("store:",r);console.log("cells:",r.state.grid.cells);const N=document.querySelector("#app .grid"),I=[];r.state.grid.cells.forEach(({value:s})=>{const e=document.createElement("div");e.classList.add("box"),s==="set"&&e.classList.add("active"),I.push(e),N.appendChild(e)});const L=document.querySelector("#app .footer .bank"),U=[...L.querySelectorAll(".bank-pieces .piece img")];L.querySelector(".bank-pieces");w.loadImages([{name:"tile",url:"src/imgs/tile.png"},{name:"tile-highlight",url:"src/imgs/tile-highlight.png"},{name:"tile-hover",url:"src/imgs/tile-hover.png"}],s=>console.log("Progress:",s),()=>{r.mutate.addPieceToBank(),r.mutate.addPieceToBank(),r.mutate.addPieceToBank(),A()});function A(){window.requestAnimationFrame(A),r.getters.gridChanged()&&W(),r.getters.bankChanged()&&V()}function W(){console.log("redraw grid"),r.state.grid.cells.forEach(({value:s},e)=>{const t=I[e];s==="set"?t.classList.add("active"):t.classList.remove("active")}),r.mutate.hasRendered("grid")}function V(){console.log("redraw bank"),r.state.bankPieces.forEach((s,e)=>{U[e].src=s.thumbnail.src}),r.mutate.hasRendered("bank")}
