var V=Object.defineProperty;var J=(n,e,t)=>e in n?V(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var p=(n,e,t)=>(J(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}})();const D="modulepreload",F=function(n){return"/"+n},R={},W=function(e,t,s){if(!t||t.length===0)return e();const a=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=F(i),i in R)return;R[i]=!0;const l=i.endsWith(".css"),o=l?'[rel="stylesheet"]':"";if(!!s)for(let E=a.length-1;E>=0;E--){const y=a[E];if(y.href===i&&(!l||y.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${o}`))return;const m=document.createElement("link");if(m.rel=l?"stylesheet":D,l||(m.as="script",m.crossOrigin=""),m.href=i,document.head.appendChild(m),l)return new Promise((E,y)=>{m.addEventListener("load",E),m.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e())};function q(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:s,onRegistered:a,onRegisteredSW:i,onRegisterError:l}=n;let o,c;const m=async(y=!0)=>{await c};async function E(){if("serviceWorker"in navigator){const{Workbox:y}=await W(()=>import("./workbox-window.prod.es5-a7b12eab.js"),[]);o=new y("/sw.js",{scope:"/",type:"classic"}),o.addEventListener("activated",h=>{(h.isUpdate||h.isExternal)&&window.location.reload()}),o.addEventListener("installed",h=>{h.isUpdate||s==null||s()}),o.register({immediate:e}).then(h=>{i?i("/sw.js",h):a==null||a(h)}).catch(h=>{l==null||l(h)})}}return c=E(),m}"serviceWorker"in navigator&&!/localhost/.test(window.location)&&q();let w;const b=document.querySelector("#install-btn");window.addEventListener("beforeinstallprompt",n=>{n.preventDefault(),w=n,b.style.display="block",b.addEventListener("click",()=>{b.style.display="none",w.prompt(),w.userChoice.then(e=>{e.outcome==="accepted"?console.log("User accepted the A2HS prompt"):console.log("User dismissed the A2HS prompt"),w=null})})});(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0)&&(b.style.display="none");const G=()=>{var n;return!!((n=window.matchMedia)!=null&&n.call(window,"(display-mode: standalone)").matches||window.navigator.standalone)};G()&&(b.style.display="none");window.addEventListener("appinstalled",n=>{console.log("success app install!")});const x=class{constructor(e,t,s=x.UNSET){this.x=e,this.y=t,this.value=s}};let d=x;p(d,"UNSET","unset"),p(d,"SET","set"),p(d,"PREVIEW","preview");class K{constructor(){p(this,"cells",Array.from({length:100}).map((e,t)=>new d(t%10,Math.floor(t/10))));p(this,"previousCells",null)}getCellValueAtIndex(e){return this.cells[e].value}setCellValueAtIndex(e,t){if(e<0||e>this.cells.length)return console.log("ERROR - index out of range:",e),null;this.cells[e].value=t}getCellValueAtPoint(e,t){return e<0||e>9||t<0||t>9?(console.log("ERROR - index out of range:",index),null):this.getCellValueAtIndex(this.pointToIndex(e,t))}setCellValueAtPoint(e,t,s){this.setCellValueAtIndex(this.pointToIndex(e,t),s)}pointToIndex(e,t){return e+10*t}reset(){this.cells.forEach(e=>{e.value=d.UNSET})}doesItFitAt(e,t,s,a=d.SET){this.previousCells=this.getState().cells,this.cells.forEach(h=>{h.value===d.PREVIEW&&(h.value=d.UNSET)});const i=1+Math.max(...s.map(([h])=>h))-Math.min(...s.map(([h])=>h)),l=1+Math.max(...s.map(([,h])=>h))-Math.min(...s.map(([,h])=>h)),o=Math[i%2===0?"round":"floor"](e*10),c=Math[l%2===0?"round":"floor"](t*10);if(o<-1||o>9||c<-1||c>9)return!1;const m=o-Math[i%2===0?"round":"floor"](i/2),E=c-Math[l%2===0?"round":"floor"](l/2);let y=!0;return s.forEach(([h,N])=>{const A=m+h,S=E+N;A>-1&&A<10&&S>-1&&S<10?this.getCellValueAtPoint(A,S)===d.SET&&(y=!1):y=!1}),s.forEach(([h,N])=>{const A=m+h,S=E+N;if(A>-1&&A<10&&S>-1&&S<10){const M=this.getCellValueAtPoint(A,S);this.setCellValueAtPoint(A,S,M===d.SET?d.SET:y?a:d.UNSET)}}),y}getState(){return JSON.parse(JSON.stringify({cells:this.cells}))}setState(e){this.reset(),this.cells.length=0,this.cells=e.map(({x:t,y:s,value:a})=>new d(t,s,a))}}const C=class{static loadImages(e,t,s){let a=0;for(let{name:i,url:l}of e){const o=new Image;o.onload=()=>{a+=1/e.length,t(a),a==1&&s()},o.src=l,C.files[i]=o}}static getImage(e){return C.files[e]}};let k=C;p(k,"files",{});const g=class{constructor(e=g.getRandomType()){p(this,"imageString","");this.type=e,this.polyline=JSON.parse(JSON.stringify(e===g.PIECE_NONE.type?g.PIECE_NONE:g.PIECES.find(t=>t.type===e))),this.makeThumbnail()}static getRandomType(){return g.PIECES[Math.floor(g.PIECES.length*Math.random())].type}rotatePiece(){const e=1+Math.max(...this.polyline.points.map(([o])=>o))-Math.min(...this.polyline.points.map(([o])=>o)),t=1+Math.max(...this.polyline.points.map(([,o])=>o))-Math.min(...this.polyline.points.map(([,o])=>o)),s=Math.max(e,t),{points:a}=this.polyline;let i=[];for(let o=0;o<s;o+=1){i.push([]);for(let c=0;c<s;c+=1){const m=a.find(([E,y])=>c===E&&o===y);i[o].push(m?1:0)}}i=i.map((o,c)=>i.map(m=>m[c]).reverse());const l=e-t;if(e>t)for(let o=0;o<s;o+=1)for(let c=0;c<s;c+=1)c+l<s?i[o][c]=i[o][c+l]:i[o][c]=0;this.polyline.points=[];for(let o=0;o<i.length;o+=1)for(let c=0;c<i[o].length;c+=1)i[c][o]===1&&this.polyline.points.push([o,c]);this.makeThumbnail()}copyPiece(e){this.type=e.type,this.polyline=JSON.parse(JSON.stringify(this.type===g.PIECE_NONE.type?g.PIECE_NONE:g.PIECES.find(({type:t})=>t===this.type))),this.makeThumbnail()}shuffle(){this.type=g.getRandomType(),this.polyline=JSON.parse(JSON.stringify(this.type===g.PIECE_NONE.type?g.PIECE_NONE:g.PIECES.find(({type:e})=>e===this.type))),this.makeThumbnail()}disable(){this.polyline=g.PIECE_NONE,this.type=g.PIECE_NONE.type,this.makeThumbnail()}getState(){return JSON.parse(JSON.stringify({type:this.type,polyline:this.polyline,imageString:this.imageString}))}setState({type:e,polyline:t,imageString:s}){this.type=e,this.polyline=t,this.imageString=s}makeThumbnail(){g.canvas.width=100,g.canvas.height=100;const e=g.context;e.clearRect(0,0,100,100);const t=k.getImage("tile"),s=1+Math.max(...this.polyline.points.map(([i])=>i))-Math.min(...this.polyline.points.map(([i])=>i)),a=1+Math.max(...this.polyline.points.map(([,i])=>i))-Math.min(...this.polyline.points.map(([,i])=>i));if(t)for(let[i,l]of this.polyline.points)e.drawImage(t,50-s*10+i*20,50-a*10+l*20,18,18);this.imageString=g.canvas.toDataURL("image/png").replace("image/png","image/octet-stream")}};let f=g;p(f,"PIECE_NONE",{type:"none",points:[]}),p(f,"PIECES",[{type:"MidX4",points:[[0,0],[1,1],[2,2],[3,3]]},{type:"MidX2",points:[[0,0],[1,1],[2,2]]},{type:"MidX",points:[[0,0],[1,1]]},{type:"MidPlus",points:[[1,0],[0,1],[1,1],[2,1],[1,2]]},{type:"MidTT",points:[[0,0],[1,0],[2,0],[1,1],[1,2]]},{type:"MidT",points:[[0,0],[1,0],[2,0],[1,1]]},{type:"MidL",points:[[0,0],[1,0],[0,1],[0,2]]},{type:"MidL2",points:[[0,0],[1,0],[2,0],[2,1]]},{type:"BigL",points:[[0,0],[1,0],[2,0],[2,1],[2,2]]},{type:"SmallL",points:[[0,0],[1,0],[1,1]]},{type:"Dot",points:[[0,0]]},{type:"SmallSquare",points:[[0,0],[1,0],[0,1],[1,1]]},{type:"BigSquare",points:[[0,0],[1,0],[2,0],[0,1],[1,1],[2,1],[0,2],[1,2],[2,2]]},{type:"Line2",points:[[0,0],[1,0]]},{type:"Line3",points:[[0,0],[1,0],[2,0]]},{type:"Line4",points:[[0,0],[1,0],[2,0],[3,0]]},{type:"Line5",points:[[0,0],[1,0],[2,0],[3,0],[4,0]]}]),p(f,"canvas",document.createElement("canvas")),p(f,"context",g.canvas.getContext("2d"));const r={score:0,bankPieces:[new f(f.PIECE_NONE.type),new f(f.PIECE_NONE.type),new f(f.PIECE_NONE.type)],backupPiece:new f(f.PIECE_NONE.type),grid:new K,changes:{grid:{previous:0,value:1},bank:{previous:0,value:1}},history:[]},u={state:r,mutate:{undo(){const{score:n=r.score,bankPieces:e,backupPiece:t,grid:s}=r.history.pop()||{};e&&t&&s&&(u.mutate.restart(),r.score=n,r.bankPieces.forEach((a,i)=>a.setState(e[i])),r.backupPiece.setState(t),r.grid.setState(s),r.changes.grid.value+=1,r.changes.bank.value+=1)},saveHistory(){const{score:n,bankPieces:e,backupPiece:t,grid:s}=r;r.history.push({score:n,bankPieces:e.map(a=>a.getState()),backupPiece:t.getState(),grid:s.previousCells.map(({x:a,y:i,value:l})=>({x:a,y:i,value:l===d.SET?d.SET:d.UNSET}))})},resetBank(){r.bankPieces.forEach(n=>n.shuffle()),r.changes.bank.value+=1},restart(){r.grid.reset(),r.score=0,u.mutate.resetBank(),r.backupPiece.disable(),r.changes.grid.value+=1},hasRendered(n){r.changes[n].previous=r.changes[n].value},bumpScoreBy(n){r.score+=n},setBackupPiece(n){r.changes.bank.value+=1,r.backupPiece.copyPiece(n)},removeFromBank(n){r.changes.bank.value+=1,n.disable(),r.bankPieces.filter(({type:e})=>e===f.PIECE_NONE.type).length===3&&u.mutate.resetBank()},checkWins(){const n=[],e=[];for(let t=0;t<10;t+=1){let s=0,a=0;for(let i=0;i<10;i+=1)r.grid.getCellValueAtPoint(i,t)===d.SET&&(s+=1),r.grid.getCellValueAtPoint(t,i)===d.SET&&(a+=1);n.push(s),e.push(a)}for(let t=0;t<10;t+=1){if(n[t]==10)for(let s=0;s<10;s+=1)r.grid.setCellValueAtPoint(s,t,d.UNSET);if(e[t]==10)for(let s=0;s<10;s+=1)r.grid.setCellValueAtPoint(t,s,d.UNSET)}}},getters:{getPieceById:n=>{switch(n){case"bank-piece-1":return r.bankPieces[0];case"bank-piece-2":return r.bankPieces[1];case"bank-piece-3":return r.bankPieces[2];case"backup-piece":return r.backupPiece}},canAcceptBackup:()=>r.backupPiece.type===f.PIECE_NONE.type,gridChanged:()=>r.changes.grid.previous!==r.changes.grid.value,bankChanged:()=>r.changes.bank.previous!==r.changes.bank.value}};class H{constructor(e,t,s){p(this,"image",new Image);p(this,"pieceId","");p(this,"lastX",-1);p(this,"lastY",-1);p(this,"startX",-1);p(this,"startY",-1);p(this,"touchStart",e=>{e.stopPropagation(),e.preventDefault();const[t]=e.touches;"pageX"in e||(e.pageX=t.pageX,e.pageY=t.pageY),this.dragStart(e)});p(this,"dragStart",e=>{if(this.dragging)return;this.pieceId=e.target.id,this.callBack("drag",{pieceId:this.pieceId}),this.image.src=e.target.src,this.showImage();const{width:t}=this.dragTo.getBoundingClientRect(),s=t/2.4;this.image.style.width=this.image.style.height=s+"px",this.image.style.top=e.pageY-window.scrollY-s/2+"px",this.image.style.left=e.pageX-s/2+"px",this.image.focus();const{x:a,y:i}=this.getDropPosition(e);this.startX=a,this.startY=i});p(this,"touchMove",e=>{const[t]=e.touches;"pageX"in e||(e.pageX=t.pageX,e.pageY=t.pageY),this.dragMove(e)});p(this,"dragMove",e=>{if(!this.dragging)return;const{width:t}=this.dragTo.getBoundingClientRect(),s=t/2.2;this.image.style.width=this.image.style.height=s+"px",this.image.style.top=e.pageY-window.scrollY-s/2+"px",this.image.style.left=e.pageX-s/2+"px";const{x:a,y:i}=this.getDropPosition(e);this.lastX=a,this.lastY=i,this.callBack("move",{x:a,y:i,pieceId:this.pieceId})});p(this,"dragStop",e=>{this.dragging&&(e.preventDefault(),e.stopPropagation(),this.lastX===-1&&this.lastY===-1||this.lastY>1&&this.lastX>0&&this.lastX<.8?(console.log("ROTATE"),this.callBack("rotate",{x:this.lastX,y:this.lastY,pieceId:this.pieceId}),this.pieceId=null,this.hideImage()):(this.callBack("drop",{x:this.lastX,y:this.lastY,pieceId:this.pieceId}),this.pieceId=null,this.hideImage(),navigator.vibrate(60)),this.lastX=this.lastY=-1)});this.dragFromElements=e,this.dragTo=t,this.callBack=s,this.image.id="draggable-image",this.image.draggable=!1,this.image.style.imageRendering="pixelated",this.image.style.position="fixed",document.body.appendChild(this.image),this.hideImage(),e.forEach((a,i)=>{a.addEventListener("mousedown",this.dragStart),a.addEventListener("touchstart",this.touchStart),document.addEventListener("touchmove",this.touchMove),document.addEventListener("mousemove",this.dragMove),document.addEventListener("touchup",this.dragStop),document.addEventListener("touchend",this.dragStop),document.addEventListener("touchcancel",this.dragStop),document.addEventListener("mouseleave",this.dragStop),document.addEventListener("mouseup",this.dragStop)})}getDropPosition(e){const t=e.pageX,s=e.pageY-window.scrollY,a=10,i=5,{left:l,top:o,width:c,height:m}=this.dragTo.getBoundingClientRect(),E=(t-l-a)/(c-a*2),y=(s-o-i)/(m-i*2);return{x:E,y}}showImage(){this.image.style.display="block",document.body.style.overflow="hidden",document.body.style.touchAction="none"}hideImage(){this.image.style.display="none",document.body.style.overflow="auto",document.body.style.touchAction=d.UNSET}get dragging(){return this.pieceId!==null&&this.pieceId!==""}}const Q="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAACXBIWXMAAC4jAAAuIwF4pT92AAAAkElEQVQ4je2TsQ2EMBAE5yxniBKQaOGroJKviqJoAR0lIGJ/5MdgbBmLkI0u2J07nbSiqgB86Rw3NbIIgKjqH9C35YB53UEyqIsAnyYdnrYYJIM65wG5cAo2r2BKtl8p9Ju0rVzWD/68kovCvxwgV4YQeA5mIbmNKT3ykxcSy8LegZoCwqnFNRpZxPihFgDwA8xLMfsgKlu+AAAAAElFTkSuQmCC",j="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAnUlEQVQ4je3UsRGAIAwF0ITDHWzcx9YpnMkpaN3Hxh0sYiHh4hlEoqW/EozvcngEiQhi0oMhCADgJdQv9crcpe8RKbbG0NA+h8J6AgGJiDRobPLItOlgwhi6Q3JoWA/MyZc1kFbv9DJbvFxw2086lOemYlqhhDWgiJU6yOXTM/ux+qS/yXfMctE5l6lhCU8NB3Gw8YYVgjjPePF60u7kPTzr9IUubAAAAABJRU5ErkJggg==",z="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAACXBIWXMAAC4jAAAuIwF4pT92AAAAkElEQVQ4je2TsRHDIBAEF0aZEjVAEerKXXjUhbtyD/8NOFGMorcwGAYxDn3RB3f78DPnRASAEMKdi1LVDcCJyBtwe/UDHssJcjHGArDO9fBzL0E+BaxzG5B7LOd7ttdgJl+39Wuywf7a86L0Lh+Qb4YUmAebkNbGmn5ykz+k1ARnB0YKCFmLR6Sqm7dhFABwAK+SM/VZKn/WAAAAAElFTkSuQmCC",{state:v,getters:T}=u,{grid:B}=v,{cells:Z}=B,$=document.querySelector("#restart-btn");$.addEventListener("click",()=>u.mutate.restart());const _=document.querySelector("#undo-btn");_.addEventListener("click",()=>u.mutate.undo());const O=document.querySelector("#app .grid"),L=[];Z.forEach(({value:n})=>{const e=document.createElement("div");e.classList.add("box"),n===d.SET&&e.classList.add("active"),L.push(e),O.appendChild(e)});const ee=document.querySelector("#app .score-header .score-value"),Y=document.querySelector("#app .footer .bank"),I=[...Y.querySelectorAll(".next.piece img")],P=Y.querySelector(".backup.piece img");new H([...I,P],O,(n,e)=>{const{x:t,y:s,pieceId:a}=e,i=document.getElementById(a),l=T.getPieceById(a);switch(n){case"rotate":console.log("ROTATE",i),l.rotatePiece(),i.src=l.imageString,i.style.opacity=1,v.changes.bank.value+=1,U();break;case"drag":i.style.opacity=0;break;case"move":const{points:o}=l.polyline;B.doesItFitAt(t,s,o,d.PREVIEW),v.changes.grid.value+=1;break;case"drop":{if(t>.75&&s>1&&u.getters.canAcceptBackup()){console.log("BANK DROP!"),u.mutate.saveHistory(),u.mutate.setBackupPiece(l),u.mutate.removeFromBank(l);return}const{points:c}=l.polyline;B.doesItFitAt(t,s,c,d.SET)?(u.mutate.saveHistory(),u.mutate.bumpScoreBy(c.length),u.mutate.removeFromBank(l),u.mutate.checkWins(),i.style.opacity=0):i.style.opacity=1,v.changes.grid.value+=1}break}});k.loadImages([{name:"tile",url:Q},{name:"tile-highlight",url:j},{name:"tile-hover",url:z}],n=>console.log("Progress:",n),()=>{u.mutate.restart(),X()});function X(){window.requestAnimationFrame(X),T.gridChanged()&&(ie(),te()),T.bankChanged()&&U()}function te(){ee.innerHTML=v.score.toLocaleString()}function ie(){console.log("redraw grid");const{cells:n}=u.state.grid;n.forEach(({value:e},t)=>{const s=L[t];s.className="box "+e}),u.mutate.hasRendered("grid")}function U(){console.log("redraw bank"),u.state.bankPieces.forEach((n,e)=>{I[e].src=n.imageString,I[e].setAttribute("piece-type",n.type),I[e].style.opacity=1}),P.src=u.state.backupPiece.imageString,P.style.opacity=1,P.setAttribute("piece-type",u.state.backupPiece.type),u.mutate.hasRendered("bank")}console.log("v1.0.1");
