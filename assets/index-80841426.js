var D=Object.defineProperty;var V=(i,e,t)=>e in i?D(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var c=(i,e,t)=>(V(i,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();const F="modulepreload",W=function(i){return"/"+i},T={},J=function(e,t,o){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(n=>{if(n=W(n),n in T)return;T[n]=!0;const a=n.endsWith(".css"),l=a?'[rel="stylesheet"]':"";if(!!o)for(let A=s.length-1;A>=0;A--){const m=s[A];if(m.href===n&&(!a||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${l}`))return;const h=document.createElement("link");if(h.rel=a?"stylesheet":F,a||(h.as="script",h.crossOrigin=""),h.href=n,document.head.appendChild(h),a)return new Promise((A,m)=>{h.addEventListener("load",A),h.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e())};function q(i={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:o,onRegistered:s,onRegisteredSW:n,onRegisterError:a}=i;let l,f;const h=async(m=!0)=>{await f};async function A(){if("serviceWorker"in navigator){const{Workbox:m}=await J(()=>import("./workbox-window.prod.es5-a7b12eab.js"),[]);l=new m("/sw.js",{scope:"/",type:"classic"}),l.addEventListener("activated",r=>{(r.isUpdate||r.isExternal)&&window.location.reload()}),l.addEventListener("installed",r=>{r.isUpdate||o==null||o()}),l.register({immediate:e}).then(r=>{n?n("/sw.js",r):s==null||s(r)}).catch(r=>{a==null||a(r)})}}return f=A(),h}console.log("Initializing PWA...");"serviceWorker"in navigator&&!/localhost/.test(window.location)&&q();let v;const w=document.querySelector("#main-install-app-button");console.log("Running");window.addEventListener("beforeinstallprompt",i=>{i.preventDefault(),v=i,w.style.display="block",w.addEventListener("click",()=>{console.log("CLICK!"),w.style.display="none",v.prompt(),v.userChoice.then(e=>{e.outcome==="accepted"?console.log("User accepted the A2HS prompt"):console.log("User dismissed the A2HS prompt"),v=null})})});(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0)&&(w.style.display="none");const K=()=>{var i;return!!((i=window.matchMedia)!=null&&i.call(window,"(display-mode: standalone)").matches||window.navigator.standalone)};K()&&(w.style.display="none");window.addEventListener("appinstalled",i=>{console.log("success app install!")});const x=class{constructor(e,t,o=x.UNSET){this.x=e,this.y=t,this.value=o}};let u=x;c(u,"UNSET",""),c(u,"SET","set"),c(u,"PREVIEW","preview");class G{constructor(){c(this,"cells",Array.from({length:100}).map((e,t)=>new u(t%10,Math.floor(t/10))))}getCellValueAtIndex(e){return this.cells[e].value}setCellValueAtIndex(e,t){if(e<0||e>this.cells.length)return console.log("ERROR - index out of range:",e),null;this.cells[e].value=t}getCellValueAtPoint(e,t){return e<0||e>9||t<0||t>9?(console.log("ERROR - index out of range:",index),null):this.getCellValueAtIndex(this.pointToIndex(e,t))}setCellValueAtPoint(e,t,o){this.setCellValueAtIndex(this.pointToIndex(e,t),o)}pointToIndex(e,t){return e+10*t}doesItFitAt(e,t,o,s=u.SET){this.cells.forEach(r=>{r.value===u.PREVIEW&&(r.value=u.UNSET)});const n=1+Math.max(...o.map(([r])=>r))-Math.min(...o.map(([r])=>r)),a=1+Math.max(...o.map(([,r])=>r))-Math.min(...o.map(([,r])=>r)),l=Math.floor(e*10),f=Math.floor(t*10);if(l<-1||l>9||f<-1||f>9)return!1;const h=l-Math.floor(n/2),A=f-Math.floor(a/2);let m=!0;return o.forEach(([r,B])=>{const E=h+r,b=A+B;E>-1&&E<10&&b>-1&&b<10?this.getCellValueAtPoint(E,b)===u.SET&&(m=!1):m=!1}),o.forEach(([r,B])=>{const E=h+r,b=A+B;if(E>-1&&E<10&&b>-1&&b<10){const L=this.getCellValueAtPoint(E,b);this.setCellValueAtPoint(E,b,L===u.SET?u.SET:m?s:u.UNSET)}}),m}}const C=class{static loadImages(e,t,o){let s=0;for(let{name:n,url:a}of e){const l=new Image;l.onload=()=>{s+=1/e.length,t(s),s==1&&o()},l.src=a,C.files[n]=l}}static getImage(e){return C.files[e]}};let I=C;c(I,"files",{});const d=class{constructor(e=d.getRandomType()){c(this,"thumbnail",null);this.type=e,this.polyline=JSON.parse(JSON.stringify(e===d.PIECE_NONE.type?d.PIECE_NONE:d.PIECES.find(t=>t.type===e))),this.thumbnail=this.makeThumbnail()}static getRandomType(){return d.PIECES[Math.floor(d.PIECES.length*Math.random())].type}shuffle(){this.type=d.getRandomType(),this.polyline=JSON.parse(JSON.stringify(this.type===d.PIECE_NONE.type?d.PIECE_NONE:d.PIECES.find(({type:e})=>e===this.type))),this.thumbnail=this.makeThumbnail()}disable(){this.polyline=d.PIECE_NONE,this.type=d.PIECE_NONE.type,this.thumbnail=this.makeThumbnail()}makeThumbnail(){const e=new Image;e.width=d.canvas.width=100,e.height=d.canvas.height=100;const t=d.context;t.clearRect(0,0,100,100);const o=I.getImage("tile"),s=1+Math.max(...this.polyline.points.map(([a])=>a))-Math.min(...this.polyline.points.map(([a])=>a)),n=1+Math.max(...this.polyline.points.map(([,a])=>a))-Math.min(...this.polyline.points.map(([,a])=>a));if(o)for(let[a,l]of this.polyline.points)t.drawImage(o,50-s*10+a*20,50-n*10+l*20,18,18);return e.src=d.canvas.toDataURL("image/png").replace("image/png","image/octet-stream"),e}};let p=d;c(p,"PIECE_NONE",{type:"none",points:[]}),c(p,"PIECES",[{type:"BigL",rotationAble:!0,points:[[0,0],[1,0],[2,0],[2,1],[2,2]]},{type:"SmallL",rotationAble:!0,points:[[0,0],[1,0],[1,1]]},{type:"Dot",rotationAble:!1,points:[[0,0]]},{type:"SmallSquare",rotationAble:!1,points:[[0,0],[1,0],[0,1],[1,1]]},{type:"BigSquare",rotationAble:!1,points:[[0,0],[1,0],[2,0],[0,1],[1,1],[2,1],[0,2],[1,2],[2,2]]},{type:"Line2",rotationAble:!0,points:[[0,0],[1,0]]},{type:"Line3",rotationAble:!0,points:[[0,0],[1,0],[2,0]]},{type:"Line4",rotationAble:!0,points:[[0,0],[1,0],[2,0],[3,0]]},{type:"Line5",rotationAble:!0,points:[[0,0],[1,0],[2,0],[3,0],[4,0]]}]),c(p,"canvas",document.createElement("canvas")),c(p,"context",d.canvas.getContext("2d"));const g={score:0,bankPieces:[new p(p.PIECE_NONE.type),new p(p.PIECE_NONE.type),new p(p.PIECE_NONE.type)],backupPiece:new p(p.PIECE_NONE.type),grid:new G,changes:{grid:{previous:0,value:1},bank:{previous:0,value:1}}},y={state:g,mutate:{resetBank(){g.bankPieces.forEach(i=>i.shuffle()),g.changes.bank.value+=1},hasRendered(i){g.changes[i].previous=g.changes[i].value},bumpScoreBy(i){g.score+=i},removeFromBank(i){g.changes.bank.value+=1,i.disable(),console.log("+++",g.bankPieces.filter(({type:e})=>e===p.PIECE_NONE.type)),g.bankPieces.filter(({type:e})=>e===p.PIECE_NONE.type).length===3&&(y.mutate.resetBank(),g.changes.bank.value+=1)}},getters:{getPieceById:i=>{switch(i){case"bank-piece-1":return g.bankPieces[0];case"bank-piece-2":return g.bankPieces[1];case"bank-piece-3":return g.bankPieces[2];case"backup-piece":return g.backupPiece}},gridChanged:()=>g.changes.grid.previous!==g.changes.grid.value,bankChanged:()=>g.changes.bank.previous!==g.changes.bank.value}};class Q{constructor(e,t,o){c(this,"image",new Image);c(this,"pieceId","");c(this,"lastX",-1);c(this,"lastY",-1);c(this,"touchStart",e=>{e.stopPropagation(),e.preventDefault();const[t]=e.touches;"pageX"in e||(e.pageX=t.pageX,e.pageY=t.pageY),this.dragStart(e)});c(this,"dragStart",e=>{this.pieceId=e.target.id,this.callBack("drag",{pieceId:this.pieceId}),this.image.src=e.target.src,this.showImage();const{width:t}=this.dragTo.getBoundingClientRect(),o=t/2.1;this.image.style.width=this.image.style.height=o+"px",this.image.style.top=e.pageY-window.scrollY-o/2+"px",this.image.style.left=e.pageX-o/2+"px",this.image.focus()});c(this,"touchMove",e=>{const[t]=e.touches;"pageX"in e||(e.pageX=t.pageX,e.pageY=t.pageY),this.dragMove(e)});c(this,"dragMove",e=>{if(!this.dragging)return;const{width:t}=this.dragTo.getBoundingClientRect(),o=t/2.2;this.image.style.width=this.image.style.height=o+"px",this.image.style.top=e.pageY-window.scrollY-o/2+"px",this.image.style.left=e.pageX-o/2+"px";const{x:s,y:n}=this.getDropPosition(e);this.lastX=s,this.lastY=n,this.callBack("move",{x:s,y:n,pieceId:this.pieceId})});c(this,"dragStop",e=>{this.dragging&&(e.preventDefault(),e.stopPropagation(),this.callBack("drop",{x:this.lastX,y:this.lastY,pieceId:this.pieceId}),this.pieceId=null,this.hideImage(),navigator.vibrate(60))});this.dragFromElements=e,this.dragTo=t,this.callBack=o,this.image.id="draggable-image",this.image.draggable=!1,this.image.style.imageRendering="pixelated",this.image.style.position="fixed",document.body.appendChild(this.image),this.hideImage(),e.forEach((s,n)=>{s.addEventListener("mousedown",this.dragStart),s.addEventListener("touchstart",this.touchStart),document.addEventListener("touchmove",this.touchMove),document.addEventListener("mousemove",this.dragMove),document.addEventListener("touchup",this.dragStop),document.addEventListener("touchend",this.dragStop),document.addEventListener("touchcancel",this.dragStop),document.addEventListener("mouseleave",this.dragStop),document.addEventListener("mouseup",this.dragStop)})}getDropPosition(e){const t=e.pageX,o=e.pageY-window.scrollY,s=10,n=5,{left:a,top:l,width:f,height:h}=this.dragTo.getBoundingClientRect(),A=(t-a-s)/(f-s*2),m=(o-l-n)/(h-n*2);return{x:A,y:m}}showImage(){this.image.style.display="block",document.body.style.overflow="hidden",document.body.style.touchAction="none"}hideImage(){this.image.style.display="none",document.body.style.overflow="auto",document.body.style.touchAction=u.UNSET}get dragging(){return this.pieceId!==null&&this.pieceId!==""}}const j="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAACXBIWXMAAC4jAAAuIwF4pT92AAAAkElEQVQ4je2TsQ2EMBAE5yxniBKQaOGroJKviqJoAR0lIGJ/5MdgbBmLkI0u2J07nbSiqgB86Rw3NbIIgKjqH9C35YB53UEyqIsAnyYdnrYYJIM65wG5cAo2r2BKtl8p9Ju0rVzWD/68kovCvxwgV4YQeA5mIbmNKT3ykxcSy8LegZoCwqnFNRpZxPihFgDwA8xLMfsgKlu+AAAAAElFTkSuQmCC",H="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAnUlEQVQ4je3UsRGAIAwF0ITDHWzcx9YpnMkpaN3Hxh0sYiHh4hlEoqW/EozvcngEiQhi0oMhCADgJdQv9crcpe8RKbbG0NA+h8J6AgGJiDRobPLItOlgwhi6Q3JoWA/MyZc1kFbv9DJbvFxw2086lOemYlqhhDWgiJU6yOXTM/ux+qS/yXfMctE5l6lhCU8NB3Gw8YYVgjjPePF60u7kPTzr9IUubAAAAABJRU5ErkJggg==",z="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAACXBIWXMAAC4jAAAuIwF4pT92AAAAkElEQVQ4je2TsRHDIBAEF0aZEjVAEerKXXjUhbtyD/8NOFGMorcwGAYxDn3RB3f78DPnRASAEMKdi1LVDcCJyBtwe/UDHssJcjHGArDO9fBzL0E+BaxzG5B7LOd7ttdgJl+39Wuywf7a86L0Lh+Qb4YUmAebkNbGmn5ykz+k1ARnB0YKCFmLR6Sqm7dhFABwAK+SM/VZKn/WAAAAAElFTkSuQmCC",{state:S,getters:P}=y,{grid:N}=S,{cells:M}=N,O=document.querySelector("#app .grid"),Y=[];M.forEach(({value:i})=>{const e=document.createElement("div");e.classList.add("box"),i===u.SET&&e.classList.add("active"),Y.push(e),O.appendChild(e)});const Z=document.querySelector("#app .score-header .score-value"),U=document.querySelector("#app .footer .bank"),k=[...U.querySelectorAll(".next.piece img")],R=U.querySelector(".backup.piece img");new Q([...k,R],O,(i,e)=>{const{x:t,y:o,pieceId:s}=e,n=document.getElementById(s);switch(i){case"drag":n.style.opacity=0;break;case"move":const a=P.getPieceById(s),{points:l}=a.polyline;N.doesItFitAt(t,o,l,u.PREVIEW),S.changes.grid.value+=1;break;case"drop":{t>.75&&o>1&&console.log("BANK DROP!");const f=P.getPieceById(s),{points:h}=f.polyline;N.doesItFitAt(t,o,h,u.SET)?(y.mutate.bumpScoreBy(h.length),y.mutate.removeFromBank(f),n.style.opacity=0):n.style.opacity=1,S.changes.grid.value+=1}break}});I.loadImages([{name:"tile",url:j},{name:"tile-highlight",url:H},{name:"tile-hover",url:z}],i=>console.log("Progress:",i),()=>{y.mutate.resetBank(),X()});function X(){window.requestAnimationFrame(X),P.gridChanged()&&(_(),$()),P.bankChanged()&&ee()}function $(){Z.innerHTML=S.score.toLocaleString()}function _(){console.log("redraw grid"),M.forEach(({value:i},e)=>{const t=Y[e];t.className="box "+i}),y.mutate.hasRendered("grid")}function ee(){console.log("redraw bank"),y.state.bankPieces.forEach((i,e)=>{k[e].src=i.thumbnail.src,k[e].setAttribute("piece-type",i.type),k[e].style.opacity=1}),R.src=y.state.backupPiece.thumbnail.src,R.setAttribute("piece-type",y.state.backupPiece.type),y.mutate.hasRendered("bank")}console.log("v1");
