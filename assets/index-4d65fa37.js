var R=Object.defineProperty;var T=(n,e,t)=>e in n?R(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var g=(n,e,t)=>(T(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}})();const M="modulepreload",U=function(n){return"/"+n},B={},x=function(e,t,s){if(!t||t.length===0)return e();const o=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=U(i),i in B)return;B[i]=!0;const a=i.endsWith(".css"),c=a?'[rel="stylesheet"]':"";if(!!s)for(let p=o.length-1;p>=0;p--){const h=o[p];if(h.href===i&&(!a||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${c}`))return;const u=document.createElement("link");if(u.rel=a?"stylesheet":M,a||(u.as="script",u.crossOrigin=""),u.href=i,document.head.appendChild(u),a)return new Promise((p,h)=>{u.addEventListener("load",p),u.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e())};function V(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:s,onRegistered:o,onRegisteredSW:i,onRegisterError:a}=n;let c,w;const u=async(h=!0)=>{await w};async function p(){if("serviceWorker"in navigator){const{Workbox:h}=await x(()=>import("./workbox-window.prod.es5-a7b12eab.js"),[]);c=new h("/sw.js",{scope:"/",type:"classic"}),c.addEventListener("activated",A=>{(A.isUpdate||A.isExternal)&&window.location.reload()}),c.addEventListener("installed",A=>{A.isUpdate||s==null||s()}),c.register({immediate:e}).then(A=>{i?i("/sw.js",A):o==null||o(A)}).catch(A=>{a==null||a(A)})}}return w=p(),u}console.log("Initializing PWA...");"serviceWorker"in navigator&&!/localhost/.test(window.location)&&V();let E;const y=document.querySelector("#main-install-app-button");window.addEventListener("beforeinstallprompt",n=>{n.preventDefault(),E=n,y.style.display="block",y.addEventListener("click",()=>{y.style.display="none",E.prompt(),E.userChoice.then(e=>{e.outcome==="accepted"?console.log("User accepted the A2HS prompt"):console.log("User dismissed the A2HS prompt"),E=null})})});(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0)&&(y.style.display="none");const q=()=>{var n;return!!((n=window.matchMedia)!=null&&n.call(window,"(display-mode: standalone)").matches||window.navigator.standalone)};q()&&(y.style.display="none");window.addEventListener("appinstalled",n=>{console.log("success app install!")});const k=class{constructor(e,t,s=k.UNSET){this.x=e,this.y=t,this.value=s}};let f=k;g(f,"UNSET","unset"),g(f,"SET","set");class D{constructor(){g(this,"cells",Array.from({length:100}).map((e,t)=>new f(t%10,Math.floor(t/10))))}getCellValueAtIndex(e){return this.cells[e].value}setCellValueAtIndex(e,t){this.cells[e].value=t}getCellValueAtPoint(e,t){return this.getCellValueAtIndex(this.pointToIndex(e,t))}setCellValueAtPoint(e,t,s){this.setCellValueAtIndex(this.pointToIndex(e,t),s)}pointToIndex(e,t){return e+10*t}}const v=class{static loadImages(e,t,s){console.log("loading...",e);let o=0;for(let{name:i,url:a}of e){const c=new Image;c.onload=()=>{o+=1/e.length,t(o),console.log(" - progress:",o),o==1&&(console.log(" - done:",o),s())},c.src=a,v.files[i]=c}}static getImage(e){return v.files[e]}};let b=v;g(b,"files",{});const d=class{constructor(e=d.getRandomType()){g(this,"thumbnail",null);this.type=e,this.polyline=d.PIECES.find(t=>t.type===e),this.thumbnail=this.makeThumbnail()}static getRandomType(){return d.PIECES[Math.floor(d.PIECES.length*Math.random())].type}makeThumbnail(){const e=new Image;e.width=d.canvas.width=100,e.height=d.canvas.height=100;const t=d.context;t.clearRect(0,0,100,100);const s=b.getImage("tile-hover"),o=1+Math.max(...this.polyline.points.map(([a])=>a))-Math.min(...this.polyline.points.map(([a])=>a)),i=1+Math.max(...this.polyline.points.map(([,a])=>a))-Math.min(...this.polyline.points.map(([,a])=>a));if(s)for(let[a,c]of this.polyline.points)t.drawImage(s,50-o*10+a*20,50-i*10+c*20,20,20);return e.src=d.canvas.toDataURL("image/png").replace("image/png","image/octet-stream"),e}};let m=d;g(m,"PIECES",[{type:"BigL",rotationAble:!0,points:[[0,0],[1,0],[2,0],[2,1],[2,2]]},{type:"SmallL",rotationAble:!0,points:[[0,0],[1,0],[1,1]]},{type:"Dot",rotationAble:!1,points:[[0,0]]},{type:"SmallSquare",rotationAble:!1,points:[[0,0],[1,0],[0,1],[1,1]]},{type:"BigSquare",rotationAble:!1,points:[[0,0],[1,0],[2,0],[0,1],[1,1],[2,1],[0,2],[1,2],[2,2]]},{type:"Line2",rotationAble:!0,points:[[0,0],[1,0]]},{type:"Line3",rotationAble:!0,points:[[0,0],[1,0],[2,0]]},{type:"Line4",rotationAble:!0,points:[[0,0],[1,0],[2,0],[3,0]]},{type:"Line5",rotationAble:!0,points:[[0,0],[1,0],[2,0],[3,0],[4,0]]}]),g(m,"canvas",document.createElement("canvas")),g(m,"context",d.canvas.getContext("2d"));const l={bankPieces:[],backupPiece:null,grid:new D,changes:{grid:{previous:0,value:1},bank:{previous:0,value:1}}},r={state:l,mutate:{doSomething(){l.grid.setCellValueAtPoint(Math.floor(Math.random()*10),Math.floor(Math.random()*10),f[Math.random()>.5?"SET":"UNSET"]),l.changes.grid.value+=1},addPieceToBank(){l.bankPieces.push(new m),l.changes.bank.value+=1},addBackupPiece(){l.backupPiece=new m,l.changes.bank.value+=1},hasRendered(n){l.changes[n].previous=l.changes[n].value}},getters:{gridChanged:()=>l.changes.grid.previous!==l.changes.grid.value,bankChanged:()=>l.changes.bank.previous!==l.changes.bank.value}},N="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAACXBIWXMAAC4jAAAuIwF4pT92AAAAkElEQVQ4je2TsQ2EMBAE5yxniBKQaOGroJKviqJoAR0lIGJ/5MdgbBmLkI0u2J07nbSiqgB86Rw3NbIIgKjqH9C35YB53UEyqIsAnyYdnrYYJIM65wG5cAo2r2BKtl8p9Ju0rVzWD/68kovCvxwgV4YQeA5mIbmNKT3ykxcSy8LegZoCwqnFNRpZxPihFgDwA8xLMfsgKlu+AAAAAElFTkSuQmCC",O="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAnUlEQVQ4je3UsRGAIAwF0ITDHWzcx9YpnMkpaN3Hxh0sYiHh4hlEoqW/EozvcngEiQhi0oMhCADgJdQv9crcpe8RKbbG0NA+h8J6AgGJiDRobPLItOlgwhi6Q3JoWA/MyZc1kFbv9DJbvFxw2086lOemYlqhhDWgiJU6yOXTM/ux+qS/yXfMctE5l6lhCU8NB3Gw8YYVgjjPePF60u7kPTzr9IUubAAAAABJRU5ErkJggg==",W="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAACXBIWXMAAC4jAAAuIwF4pT92AAAAkElEQVQ4je2TsRHDIBAEF0aZEjVAEerKXXjUhbtyD/8NOFGMorcwGAYxDn3RB3f78DPnRASAEMKdi1LVDcCJyBtwe/UDHssJcjHGArDO9fBzL0E+BaxzG5B7LOd7ttdgJl+39Wuywf7a86L0Lh+Qb4YUmAebkNbGmn5ykz+k1ARnB0YKCFmLR6Sqm7dhFABwAK+SM/VZKn/WAAAAAElFTkSuQmCC";console.log("store:",r);console.log("cells:",r.state.grid.cells);const F=document.querySelector("#app .grid"),C=[];r.state.grid.cells.forEach(({value:n})=>{const e=document.createElement("div");e.classList.add("box"),n==="set"&&e.classList.add("active"),C.push(e),F.appendChild(e)});const P=document.querySelector("#app .footer .bank"),S=[...P.querySelectorAll(".next.piece img")],I=P.querySelector(".backup.piece img");b.loadImages([{name:"tile",url:N},{name:"tile-highlight",url:O},{name:"tile-hover",url:W}],n=>console.log("Progress:",n),()=>{r.mutate.addPieceToBank(),r.mutate.addPieceToBank(),r.mutate.addPieceToBank(),r.mutate.addBackupPiece(),L()});function L(){window.requestAnimationFrame(L),r.getters.gridChanged()&&G(),r.getters.bankChanged()&&J()}function G(){console.log("redraw grid"),r.state.grid.cells.forEach(({value:n},e)=>{const t=C[e];n==="set"?t.classList.add("active"):t.classList.remove("active")}),r.mutate.hasRendered("grid")}function J(){console.log("redraw bank"),r.state.bankPieces.forEach((n,e)=>{S[e].src=n.thumbnail.src,S[e].setAttribute("piece-type",n.type)}),I.src=r.state.backupPiece.thumbnail.src,I.setAttribute("piece-type",r.state.backupPiece.type),r.mutate.hasRendered("bank")}
