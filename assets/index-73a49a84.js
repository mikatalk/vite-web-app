var R=Object.defineProperty;var M=(s,e,t)=>e in s?R(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var r=(s,e,t)=>(M(s,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();const T="modulepreload",Y=function(s){return"/"+s},B={},U=function(e,t,a){if(!t||t.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(t.map(o=>{if(o=Y(o),o in B)return;B[o]=!0;const n=o.endsWith(".css"),c=n?'[rel="stylesheet"]':"";if(!!a)for(let u=i.length-1;u>=0;u--){const m=i[u];if(m.href===o&&(!n||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${c}`))return;const g=document.createElement("link");if(g.rel=n?"stylesheet":T,n||(g.as="script",g.crossOrigin=""),g.href=o,document.head.appendChild(g),n)return new Promise((u,m)=>{g.addEventListener("load",u),g.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>e())};function D(s={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:a,onRegistered:i,onRegisteredSW:o,onRegisterError:n}=s;let c,f;const g=async(m=!0)=>{await f};async function u(){if("serviceWorker"in navigator){const{Workbox:m}=await U(()=>import("./workbox-window.prod.es5-a7b12eab.js"),[]);c=new m("/sw.js",{scope:"/",type:"classic"}),c.addEventListener("activated",p=>{(p.isUpdate||p.isExternal)&&window.location.reload()}),c.addEventListener("installed",p=>{p.isUpdate||a==null||a()}),c.register({immediate:e}).then(p=>{o?o("/sw.js",p):i==null||i(p)}).catch(p=>{n==null||n(p)})}}return f=u(),g}console.log("Initializing PWA...");"serviceWorker"in navigator&&!/localhost/.test(window.location)&&D();let E;const w=document.querySelector("#main-install-app-button");window.addEventListener("beforeinstallprompt",s=>{s.preventDefault(),E=s,w.style.display="block",w.addEventListener("click",()=>{w.style.display="none",E.prompt(),E.userChoice.then(e=>{e.outcome==="accepted"?console.log("User accepted the A2HS prompt"):console.log("User dismissed the A2HS prompt"),E=null})})});(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0)&&(w.style.display="none");const O=()=>{var s;return!!((s=window.matchMedia)!=null&&s.call(window,"(display-mode: standalone)").matches||window.navigator.standalone)};O()&&(w.style.display="none");window.addEventListener("appinstalled",s=>{console.log("success app install!")});const S=class{constructor(e,t,a=S.UNSET){this.x=e,this.y=t,this.value=a}};let y=S;r(y,"UNSET","unset"),r(y,"SET","set");class V{constructor(){r(this,"cells",Array.from({length:100}).map((e,t)=>new y(t%10,Math.floor(t/10))))}getCellValueAtIndex(e){return this.cells[e].value}setCellValueAtIndex(e,t){this.cells[e].value=t}getCellValueAtPoint(e,t){return this.getCellValueAtIndex(this.pointToIndex(e,t))}setCellValueAtPoint(e,t,a){this.setCellValueAtIndex(this.pointToIndex(e,t),a)}pointToIndex(e,t){return e+10*t}}const v=class{static loadImages(e,t,a){console.log("loading...",e);let i=0;for(let{name:o,url:n}of e){const c=new Image;c.onload=()=>{i+=1/e.length,t(i),console.log(" - progress:",i),i==1&&(console.log(" - done:",i),a())},c.src=n,v.files[o]=c}}static getImage(e){return v.files[e]}};let b=v;r(b,"files",{});const h=class{constructor(e=h.getRandomType()){r(this,"thumbnail",null);this.type=e,this.polyline=h.PIECES.find(t=>t.type===e),this.thumbnail=this.makeThumbnail()}static getRandomType(){return h.PIECES[Math.floor(h.PIECES.length*Math.random())].type}makeThumbnail(){const e=new Image;e.width=h.canvas.width=100,e.height=h.canvas.height=100;const t=h.context;t.clearRect(0,0,100,100);const a=b.getImage("tile"),i=1+Math.max(...this.polyline.points.map(([n])=>n))-Math.min(...this.polyline.points.map(([n])=>n)),o=1+Math.max(...this.polyline.points.map(([,n])=>n))-Math.min(...this.polyline.points.map(([,n])=>n));if(a)for(let[n,c]of this.polyline.points)t.drawImage(a,50-i*10+n*20,50-o*10+c*20,18,18);return e.src=h.canvas.toDataURL("image/png").replace("image/png","image/octet-stream"),e}};let A=h;r(A,"PIECES",[{type:"BigL",rotationAble:!0,points:[[0,0],[1,0],[2,0],[2,1],[2,2]]},{type:"SmallL",rotationAble:!0,points:[[0,0],[1,0],[1,1]]},{type:"Dot",rotationAble:!1,points:[[0,0]]},{type:"SmallSquare",rotationAble:!1,points:[[0,0],[1,0],[0,1],[1,1]]},{type:"BigSquare",rotationAble:!1,points:[[0,0],[1,0],[2,0],[0,1],[1,1],[2,1],[0,2],[1,2],[2,2]]},{type:"Line2",rotationAble:!0,points:[[0,0],[1,0]]},{type:"Line3",rotationAble:!0,points:[[0,0],[1,0],[2,0]]},{type:"Line4",rotationAble:!0,points:[[0,0],[1,0],[2,0],[3,0]]},{type:"Line5",rotationAble:!0,points:[[0,0],[1,0],[2,0],[3,0],[4,0]]}]),r(A,"canvas",document.createElement("canvas")),r(A,"context",h.canvas.getContext("2d"));const d={bankPieces:[],backupPiece:null,grid:new V,changes:{grid:{previous:0,value:1},bank:{previous:0,value:1}}},l={state:d,mutate:{doSomething(){d.grid.setCellValueAtPoint(Math.floor(Math.random()*10),Math.floor(Math.random()*10),y[Math.random()>.5?"SET":"UNSET"]),d.changes.grid.value+=1},addPieceToBank(){d.bankPieces.push(new A),d.changes.bank.value+=1},addBackupPiece(){d.backupPiece=new A,d.changes.bank.value+=1},hasRendered(s){d.changes[s].previous=d.changes[s].value}},getters:{gridChanged:()=>d.changes.grid.previous!==d.changes.grid.value,bankChanged:()=>d.changes.bank.previous!==d.changes.bank.value}};class X{constructor(e,t,a){r(this,"image",new Image);r(this,"pieceId","");r(this,"lastX",-1);r(this,"lastY",-1);r(this,"touchStart",e=>{e.stopPropagation(),e.preventDefault();const[t]=e.touches;e.pageX=t.pageX,e.pageY=t.pageY,this.dragStart(e)});r(this,"dragStart",e=>{this.pieceId=e.target.id,this.callBack("drag",{pieceId:this.pieceId}),this.image.src=e.target.src,this.showImage();const{width:t}=this.dragTo.getBoundingClientRect(),a=t/2.1;this.image.style.width=this.image.style.height=a+"px",this.image.style.top=e.pageY-window.scrollY-a/2+"px",this.image.style.left=e.pageX-a/2+"px",this.image.focus()});r(this,"touchMove",e=>{const[t]=e.touches;e.pageX=t.pageX,e.pageY=t.pageY,this.dragMove(e)});r(this,"dragMove",e=>{if(!this.dragging)return;const{width:t}=this.dragTo.getBoundingClientRect(),a=t/2.1;this.image.style.width=this.image.style.height=a+"px",this.image.style.top=e.pageY-window.scrollY-a/2+"px",this.image.style.left=e.pageX-a/2+"px";const{x:i,y:o}=this.getDropPosition(e);this.lastX=i,this.lastY=o,this.callBack("move",{x:i,y:o,pieceId:this.pieceId})});r(this,"dragStop",e=>{this.dragging&&(e.preventDefault(),e.stopPropagation(),this.callBack("drop",{x:this.lastX,y:this.lastY,pieceId:this.pieceId}),this.pieceId=null,this.hideImage(),navigator.vibrate(60))});this.dragFromElements=e,this.dragTo=t,this.callBack=a,this.image.id="draggable-image",this.image.draggable=!1,this.image.style.imageRendering="pixelated",this.image.style.position="fixed",document.body.appendChild(this.image),this.hideImage(),e.forEach((i,o)=>{i.addEventListener("mousedown",this.dragStart),i.addEventListener("touchstart",this.touchStart),document.addEventListener("touchmove",this.touchMove),document.addEventListener("mousemove",this.dragMove),document.addEventListener("touchup",this.dragStop),document.addEventListener("touchend",this.dragStop),document.addEventListener("touchcancel",this.dragStop),document.addEventListener("mouseleave",this.dragStop),document.addEventListener("mouseup",this.dragStop)})}getDropPosition(e){const t=e.pageX,a=e.pageY-window.scrollY,i=5,{left:o,top:n,width:c,height:f}=this.dragTo.getBoundingClientRect(),g=(t-o)/(c-i*2),u=(a-n)/(f-i*2);return{x:g,y:u}}showImage(){this.image.style.display="block",document.body.style.overflow="hidden",document.body.style.touchAction="none"}hideImage(){this.image.style.display="none",document.body.style.overflow="auto",document.body.style.touchAction="unset"}get dragging(){return this.pieceId!==null&&this.pieceId!==""}}const q="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAACXBIWXMAAC4jAAAuIwF4pT92AAAAkElEQVQ4je2TsQ2EMBAE5yxniBKQaOGroJKviqJoAR0lIGJ/5MdgbBmLkI0u2J07nbSiqgB86Rw3NbIIgKjqH9C35YB53UEyqIsAnyYdnrYYJIM65wG5cAo2r2BKtl8p9Ju0rVzWD/68kovCvxwgV4YQeA5mIbmNKT3ykxcSy8LegZoCwqnFNRpZxPihFgDwA8xLMfsgKlu+AAAAAElFTkSuQmCC",N="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAnUlEQVQ4je3UsRGAIAwF0ITDHWzcx9YpnMkpaN3Hxh0sYiHh4hlEoqW/EozvcngEiQhi0oMhCADgJdQv9crcpe8RKbbG0NA+h8J6AgGJiDRobPLItOlgwhi6Q3JoWA/MyZc1kFbv9DJbvFxw2086lOemYlqhhDWgiJU6yOXTM/ux+qS/yXfMctE5l6lhCU8NB3Gw8YYVgjjPePF60u7kPTzr9IUubAAAAABJRU5ErkJggg==",W="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAACXBIWXMAAC4jAAAuIwF4pT92AAAAkElEQVQ4je2TsRHDIBAEF0aZEjVAEerKXXjUhbtyD/8NOFGMorcwGAYxDn3RB3f78DPnRASAEMKdi1LVDcCJyBtwe/UDHssJcjHGArDO9fBzL0E+BaxzG5B7LOd7ttdgJl+39Wuywf7a86L0Lh+Qb4YUmAebkNbGmn5ykz+k1ARnB0YKCFmLR6Sqm7dhFABwAK+SM/VZKn/WAAAAAElFTkSuQmCC";console.log("store:",l);console.log("cells:",l.state.grid.cells);const L=document.querySelector("#app .grid"),C=[];l.state.grid.cells.forEach(({value:s})=>{const e=document.createElement("div");e.classList.add("box"),s==="set"&&e.classList.add("active"),C.push(e),L.appendChild(e)});const P=document.querySelector("#app .footer .bank"),I=[...P.querySelectorAll(".next.piece img")],k=P.querySelector(".backup.piece img");new X([...I,k],L,(s,e)=>{switch(s){case"drag":{console.log("DRAG",e);const{pieceId:t}=e;document.getElementById(t).style.opacity=0}break;case"move":console.log("MOVE",e);break;case"drop":{console.log("DROP",e);const{pieceId:t}=e;document.getElementById(t).style.opacity=1}break}});b.loadImages([{name:"tile",url:q},{name:"tile-highlight",url:N},{name:"tile-hover",url:W}],s=>console.log("Progress:",s),()=>{l.mutate.addPieceToBank(),l.mutate.addPieceToBank(),l.mutate.addPieceToBank(),l.mutate.addBackupPiece(),x()});function x(){window.requestAnimationFrame(x),l.getters.gridChanged()&&G(),l.getters.bankChanged()&&F()}function G(){console.log("redraw grid"),l.state.grid.cells.forEach(({value:s},e)=>{const t=C[e];s==="set"?t.classList.add("active"):t.classList.remove("active")}),l.mutate.hasRendered("grid")}function F(){console.log("redraw bank"),l.state.bankPieces.forEach((s,e)=>{I[e].src=s.thumbnail.src,I[e].setAttribute("piece-type",s.type)}),k.src=l.state.backupPiece.thumbnail.src,k.setAttribute("piece-type",l.state.backupPiece.type),l.mutate.hasRendered("bank")}
