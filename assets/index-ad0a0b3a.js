var F=Object.defineProperty;var W=(n,e,t)=>e in n?F(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var c=(n,e,t)=>(W(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}})();const J="modulepreload",q=function(n){return"/"+n},O={},K=function(e,t,s){if(!t||t.length===0)return e();const a=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=q(i),i in O)return;O[i]=!0;const o=i.endsWith(".css"),r=o?'[rel="stylesheet"]':"";if(!!s)for(let y=a.length-1;y>=0;y--){const f=a[y];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${r}`))return;const p=document.createElement("link");if(p.rel=o?"stylesheet":J,o||(p.as="script",p.crossOrigin=""),p.href=i,document.head.appendChild(p),o)return new Promise((y,f)=>{p.addEventListener("load",y),p.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e())};function G(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:s,onRegistered:a,onRegisteredSW:i,onRegisterError:o}=n;let r,g;const p=async(f=!0)=>{await g};async function y(){if("serviceWorker"in navigator){const{Workbox:f}=await K(()=>import("./workbox-window.prod.es5-a7b12eab.js"),[]);r=new f("/sw.js",{scope:"/",type:"classic"}),r.addEventListener("activated",E=>{(E.isUpdate||E.isExternal)&&window.location.reload()}),r.addEventListener("installed",E=>{E.isUpdate||s==null||s()}),r.register({immediate:e}).then(E=>{i?i("/sw.js",E):a==null||a(E)}).catch(E=>{o==null||o(E)})}}return g=y(),p}console.log("Initializing PWA...");"serviceWorker"in navigator&&!/localhost/.test(window.location)&&G();let S;const w=document.querySelector("#main-install-app-button");console.log("Running");window.addEventListener("beforeinstallprompt",n=>{n.preventDefault(),S=n,w.style.display="block",w.addEventListener("click",()=>{console.log("CLICK!"),w.style.display="none",S.prompt(),S.userChoice.then(e=>{e.outcome==="accepted"?console.log("User accepted the A2HS prompt"):console.log("User dismissed the A2HS prompt"),S=null})})});(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0)&&(w.style.display="none");const Q=()=>{var n;return!!((n=window.matchMedia)!=null&&n.call(window,"(display-mode: standalone)").matches||window.navigator.standalone)};Q()&&(w.style.display="none");window.addEventListener("appinstalled",n=>{console.log("success app install!")});const M=class{constructor(e,t,s=M.UNSET){this.x=e,this.y=t,this.value=s}};let d=M;c(d,"UNSET",""),c(d,"SET","set"),c(d,"PREVIEW","preview");class j{constructor(){c(this,"cells",Array.from({length:100}).map((e,t)=>new d(t%10,Math.floor(t/10))))}getCellValueAtIndex(e){return this.cells[e].value}setCellValueAtIndex(e,t){if(e<0||e>this.cells.length)return console.log("ERROR - index out of range:",e),null;this.cells[e].value=t}getCellValueAtPoint(e,t){return e<0||e>9||t<0||t>9?(console.log("ERROR - index out of range:",index),null):this.getCellValueAtIndex(this.pointToIndex(e,t))}setCellValueAtPoint(e,t,s){this.setCellValueAtIndex(this.pointToIndex(e,t),s)}pointToIndex(e,t){return e+10*t}doesItFitAt(e,t,s,a=d.SET){this.cells.forEach(m=>{m.value===d.PREVIEW&&(m.value=d.UNSET)});const i=1+Math.max(...s.map(([m])=>m))-Math.min(...s.map(([m])=>m)),o=1+Math.max(...s.map(([,m])=>m))-Math.min(...s.map(([,m])=>m)),r=Math[i%2===0?"round":"floor"](e*10),g=Math[o%2===0?"round":"floor"](t*10);if(r<-1||r>9||g<-1||g>9)return!1;console.log(i,o);const p=0,y=0,f=r-Math[i%2===0?"round":"floor"](i/2+p),E=g-Math[o%2===0?"round":"floor"](o/2+y);let v=!0;return s.forEach(([m,B])=>{const b=f+m,I=E+B;b>-1&&b<10&&I>-1&&I<10?this.getCellValueAtPoint(b,I)===d.SET&&(v=!1):v=!1}),s.forEach(([m,B])=>{const b=f+m,I=E+B;if(b>-1&&b<10&&I>-1&&I<10){const L=this.getCellValueAtPoint(b,I);this.setCellValueAtPoint(b,I,L===d.SET?d.SET:v?a:d.UNSET)}}),v}}const x=class{static loadImages(e,t,s){let a=0;for(let{name:i,url:o}of e){const r=new Image;r.onload=()=>{a+=1/e.length,t(a),a==1&&s()},r.src=o,x.files[i]=r}}static getImage(e){return x.files[e]}};let k=x;c(k,"files",{});const h=class{constructor(e=h.getRandomType()){c(this,"imageString","");this.type=e,this.polyline=JSON.parse(JSON.stringify(e===h.PIECE_NONE.type?h.PIECE_NONE:h.PIECES.find(t=>t.type===e))),this.makeThumbnail()}static getRandomType(){return h.PIECES[Math.floor(h.PIECES.length*Math.random())].type}rotatePiece(){const e=1+Math.max(...this.polyline.points.map(([o])=>o))-Math.min(...this.polyline.points.map(([o])=>o)),t=1+Math.max(...this.polyline.points.map(([,o])=>o))-Math.min(...this.polyline.points.map(([,o])=>o)),s=Math.max(e,t),{points:a}=this.polyline;let i=[];for(let o=0;o<s;o+=1){i.push([]);for(let r=0;r<s;r+=1){const g=a.find(([p,y])=>r===p&&o===y);i[o].push(g?1:0)}}i=i.map((o,r)=>i.map(g=>g[r]).reverse()),this.polyline.points=[];for(let o=0;o<s;o+=1)for(let r=0;r<s;r+=1)i[o][r]===1&&this.polyline.points.push([r-Math.max(0,e-t),o-Math.max(0,t-e)]);this.makeThumbnail()}copyPiece(e){this.type=e.type,this.polyline=JSON.parse(JSON.stringify(this.type===h.PIECE_NONE.type?h.PIECE_NONE:h.PIECES.find(({type:t})=>t===this.type))),this.makeThumbnail()}shuffle(){this.type=h.getRandomType(),this.polyline=JSON.parse(JSON.stringify(this.type===h.PIECE_NONE.type?h.PIECE_NONE:h.PIECES.find(({type:e})=>e===this.type))),this.makeThumbnail()}disable(){this.polyline=h.PIECE_NONE,this.type=h.PIECE_NONE.type,this.makeThumbnail()}makeThumbnail(){h.canvas.width=100,h.canvas.height=100;const e=h.context;e.clearRect(0,0,100,100);const t=k.getImage("tile"),s=1+Math.max(...this.polyline.points.map(([i])=>i))-Math.min(...this.polyline.points.map(([i])=>i)),a=1+Math.max(...this.polyline.points.map(([,i])=>i))-Math.min(...this.polyline.points.map(([,i])=>i));if(t)for(let[i,o]of this.polyline.points)e.drawImage(t,50-s*10+i*20,50-a*10+o*20,18,18);this.imageString=h.canvas.toDataURL("image/png").replace("image/png","image/octet-stream")}};let u=h;c(u,"PIECE_NONE",{type:"none",points:[]}),c(u,"PIECES",[{type:"BigL",rotationAble:!0,points:[[0,0],[1,0],[2,0],[2,1],[2,2]]},{type:"SmallL",rotationAble:!0,points:[[0,0],[1,0],[1,1]]},{type:"Dot",rotationAble:!1,points:[[0,0]]},{type:"SmallSquare",rotationAble:!1,points:[[0,0],[1,0],[0,1],[1,1]]},{type:"BigSquare",rotationAble:!1,points:[[0,0],[1,0],[2,0],[0,1],[1,1],[2,1],[0,2],[1,2],[2,2]]},{type:"Line2",rotationAble:!0,points:[[0,0],[1,0]]},{type:"Line3",rotationAble:!0,points:[[0,0],[1,0],[2,0]]},{type:"Line4",rotationAble:!0,points:[[0,0],[1,0],[2,0],[3,0]]},{type:"Line5",rotationAble:!0,points:[[0,0],[1,0],[2,0],[3,0],[4,0]]}]),c(u,"canvas",document.createElement("canvas")),c(u,"context",h.canvas.getContext("2d"));const l={score:0,bankPieces:[new u(u.PIECE_NONE.type),new u(u.PIECE_NONE.type),new u(u.PIECE_NONE.type)],backupPiece:new u(u.PIECE_NONE.type),grid:new j,changes:{grid:{previous:0,value:1},bank:{previous:0,value:1}}},A={state:l,mutate:{resetBank(){l.bankPieces.forEach(n=>n.shuffle()),l.changes.bank.value+=1},hasRendered(n){l.changes[n].previous=l.changes[n].value},bumpScoreBy(n){l.score+=n},setBackupPiece(n){l.changes.bank.value+=1,l.backupPiece.copyPiece(n)},removeFromBank(n){l.changes.bank.value+=1,n.disable(),l.bankPieces.filter(({type:e})=>e===u.PIECE_NONE.type).length===3&&(A.mutate.resetBank(),l.changes.bank.value+=1)},checkWins(){const n=[],e=[];for(let t=0;t<10;t+=1){let s=0,a=0;for(let i=0;i<10;i+=1)l.grid.getCellValueAtPoint(i,t)===d.SET&&(s+=1),l.grid.getCellValueAtPoint(t,i)===d.SET&&(a+=1);n.push(s),e.push(a)}for(let t=0;t<10;t+=1){if(n[t]==10)for(let s=0;s<10;s+=1)l.grid.setCellValueAtPoint(s,t,d.UNSET);if(e[t]==10)for(let s=0;s<10;s+=1)l.grid.setCellValueAtPoint(t,s,d.UNSET)}}},getters:{getPieceById:n=>{switch(n){case"bank-piece-1":return l.bankPieces[0];case"bank-piece-2":return l.bankPieces[1];case"bank-piece-3":return l.bankPieces[2];case"backup-piece":return l.backupPiece}},canAcceptBackup:()=>l.backupPiece.type===u.PIECE_NONE.type,gridChanged:()=>l.changes.grid.previous!==l.changes.grid.value,bankChanged:()=>l.changes.bank.previous!==l.changes.bank.value}};class H{constructor(e,t,s){c(this,"image",new Image);c(this,"pieceId","");c(this,"lastX",-1);c(this,"lastY",-1);c(this,"startX",-1);c(this,"startY",-1);c(this,"touchStart",e=>{e.stopPropagation(),e.preventDefault();const[t]=e.touches;"pageX"in e||(e.pageX=t.pageX,e.pageY=t.pageY),this.dragStart(e)});c(this,"dragStart",e=>{if(this.dragging)return;this.pieceId=e.target.id,this.callBack("drag",{pieceId:this.pieceId}),this.image.src=e.target.src,this.showImage();const{width:t}=this.dragTo.getBoundingClientRect(),s=t/2.1;this.image.style.width=this.image.style.height=s+"px",this.image.style.top=e.pageY-window.scrollY-s/2+"px",this.image.style.left=e.pageX-s/2+"px",this.image.focus();const{x:a,y:i}=this.getDropPosition(e);this.startX=a,this.startY=i});c(this,"touchMove",e=>{const[t]=e.touches;"pageX"in e||(e.pageX=t.pageX,e.pageY=t.pageY),this.dragMove(e)});c(this,"dragMove",e=>{if(!this.dragging)return;const{width:t}=this.dragTo.getBoundingClientRect(),s=t/2.2;this.image.style.width=this.image.style.height=s+"px",this.image.style.top=e.pageY-window.scrollY-s/2+"px",this.image.style.left=e.pageX-s/2+"px";const{x:a,y:i}=this.getDropPosition(e);this.lastX=a,this.lastY=i,this.callBack("move",{x:a,y:i,pieceId:this.pieceId})});c(this,"dragStop",e=>{this.dragging&&(e.preventDefault(),e.stopPropagation(),this.lastX===-1&&this.lastY===-1?(console.log("ROTATE"),this.callBack("rotate",{x:this.lastX,y:this.lastY,pieceId:this.pieceId}),this.pieceId=null,this.hideImage()):(this.callBack("drop",{x:this.lastX,y:this.lastY,pieceId:this.pieceId}),this.pieceId=null,this.hideImage(),navigator.vibrate(60)),this.lastX=this.lastY=-1)});this.dragFromElements=e,this.dragTo=t,this.callBack=s,this.image.id="draggable-image",this.image.draggable=!1,this.image.style.imageRendering="pixelated",this.image.style.position="fixed",document.body.appendChild(this.image),this.hideImage(),e.forEach((a,i)=>{a.addEventListener("mousedown",this.dragStart),a.addEventListener("touchstart",this.touchStart),document.addEventListener("touchmove",this.touchMove),document.addEventListener("mousemove",this.dragMove),document.addEventListener("touchup",this.dragStop),document.addEventListener("touchend",this.dragStop),document.addEventListener("touchcancel",this.dragStop),document.addEventListener("mouseleave",this.dragStop),document.addEventListener("mouseup",this.dragStop)})}getDropPosition(e){const t=e.pageX,s=e.pageY-window.scrollY,a=10,i=5,{left:o,top:r,width:g,height:p}=this.dragTo.getBoundingClientRect(),y=(t-o-a)/(g-a*2),f=(s-r-i)/(p-i*2);return{x:y,y:f}}showImage(){this.image.style.display="block",document.body.style.overflow="hidden",document.body.style.touchAction="none"}hideImage(){this.image.style.display="none",document.body.style.overflow="auto",document.body.style.touchAction=d.UNSET}get dragging(){return this.pieceId!==null&&this.pieceId!==""}}const z="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAACXBIWXMAAC4jAAAuIwF4pT92AAAAkElEQVQ4je2TsQ2EMBAE5yxniBKQaOGroJKviqJoAR0lIGJ/5MdgbBmLkI0u2J07nbSiqgB86Rw3NbIIgKjqH9C35YB53UEyqIsAnyYdnrYYJIM65wG5cAo2r2BKtl8p9Ju0rVzWD/68kovCvxwgV4YQeA5mIbmNKT3ykxcSy8LegZoCwqnFNRpZxPihFgDwA8xLMfsgKlu+AAAAAElFTkSuQmCC",Z="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAnUlEQVQ4je3UsRGAIAwF0ITDHWzcx9YpnMkpaN3Hxh0sYiHh4hlEoqW/EozvcngEiQhi0oMhCADgJdQv9crcpe8RKbbG0NA+h8J6AgGJiDRobPLItOlgwhi6Q3JoWA/MyZc1kFbv9DJbvFxw2086lOemYlqhhDWgiJU6yOXTM/ux+qS/yXfMctE5l6lhCU8NB3Gw8YYVgjjPePF60u7kPTzr9IUubAAAAABJRU5ErkJggg==",$="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAACXBIWXMAAC4jAAAuIwF4pT92AAAAkElEQVQ4je2TsRHDIBAEF0aZEjVAEerKXXjUhbtyD/8NOFGMorcwGAYxDn3RB3f78DPnRASAEMKdi1LVDcCJyBtwe/UDHssJcjHGArDO9fBzL0E+BaxzG5B7LOd7ttdgJl+39Wuywf7a86L0Lh+Qb4YUmAebkNbGmn5ykz+k1ARnB0YKCFmLR6Sqm7dhFABwAK+SM/VZKn/WAAAAAElFTkSuQmCC",{state:N,getters:T}=A,{grid:R}=N,{cells:Y}=R,U=document.querySelector("#app .grid"),X=[];Y.forEach(({value:n})=>{const e=document.createElement("div");e.classList.add("box"),n===d.SET&&e.classList.add("active"),X.push(e),U.appendChild(e)});const _=document.querySelector("#app .score-header .score-value"),V=document.querySelector("#app .footer .bank"),P=[...V.querySelectorAll(".next.piece img")],C=V.querySelector(".backup.piece img");new H([...P,C],U,(n,e)=>{const{x:t,y:s,pieceId:a}=e,i=document.getElementById(a),o=T.getPieceById(a);switch(n){case"rotate":console.log("ROTATE",i),o.rotatePiece(),i.src=o.imageString,i.style.opacity=1;break;case"drag":i.style.opacity=0;break;case"move":const{points:r}=o.polyline;R.doesItFitAt(t,s,r,d.PREVIEW),N.changes.grid.value+=1;break;case"drop":{if(t>.75&&s>1&&A.getters.canAcceptBackup()){console.log("BANK DROP!"),A.mutate.setBackupPiece(o),A.mutate.removeFromBank(o);return}const{points:g}=o.polyline;R.doesItFitAt(t,s,g,d.SET)?(A.mutate.bumpScoreBy(g.length),A.mutate.removeFromBank(o),A.mutate.checkWins(),i.style.opacity=0):i.style.opacity=1,N.changes.grid.value+=1}break}});k.loadImages([{name:"tile",url:z},{name:"tile-highlight",url:Z},{name:"tile-hover",url:$}],n=>console.log("Progress:",n),()=>{A.mutate.resetBank(),D()});function D(){window.requestAnimationFrame(D),T.gridChanged()&&(te(),ee()),T.bankChanged()&&ie()}function ee(){_.innerHTML=N.score.toLocaleString()}function te(){console.log("redraw grid"),Y.forEach(({value:n},e)=>{const t=X[e];t.className="box "+n}),A.mutate.hasRendered("grid")}function ie(){console.log("redraw bank"),A.state.bankPieces.forEach((n,e)=>{P[e].src=n.imageString,P[e].setAttribute("piece-type",n.type),P[e].style.opacity=1}),C.src=A.state.backupPiece.imageString,C.style.opacity=1,C.setAttribute("piece-type",A.state.backupPiece.type),A.mutate.hasRendered("bank")}console.log("v1");
